

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Tung">
  <meta name="keywords" content="Tungçš„ä¸ªäººä¸»é¡µ">
  
    <meta name="description" content="ä¸€ã€Docker ç®€ä»‹ Docker ä¸¤ä¸ªä¸»è¦éƒ¨ä»¶ï¼š  Docker: å¼€æºçš„å®¹å™¨è™šæ‹ŸåŒ–å¹³å° Docker Hub: ç”¨äºåˆ†äº«ã€ç®¡ç† Docker å®¹å™¨çš„ Docker SaaS å¹³å° â€“Â Docker Hub  Docker ä½¿ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨ (C&#x2F;S) æ¶æ„æ¨¡å¼ã€‚Docker å®¢æˆ·ç«¯ä¼šä¸ Docker å®ˆæŠ¤è¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚Docker å®ˆæŠ¤è¿›ç¨‹ä¼šå¤„ç†å¤æ‚ç¹é‡çš„ä»»åŠ¡ï¼Œä¾‹å¦‚å»ºç«‹ã€è¿è¡Œã€å‘å¸ƒä½ çš„ D">
<meta property="og:type" content="article">
<meta property="og:title" content="éå¸¸è¯¦ç»†çš„Dockerå­¦ä¹ ç¬”è®°">
<meta property="og:url" content="http://www.tung7.com/%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3/detail_docker_study_note.html">
<meta property="og:site_name" content="Tungçš„ä¸ªäººä¸»é¡µ">
<meta property="og:description" content="ä¸€ã€Docker ç®€ä»‹ Docker ä¸¤ä¸ªä¸»è¦éƒ¨ä»¶ï¼š  Docker: å¼€æºçš„å®¹å™¨è™šæ‹ŸåŒ–å¹³å° Docker Hub: ç”¨äºåˆ†äº«ã€ç®¡ç† Docker å®¹å™¨çš„ Docker SaaS å¹³å° â€“Â Docker Hub  Docker ä½¿ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨ (C&#x2F;S) æ¶æ„æ¨¡å¼ã€‚Docker å®¢æˆ·ç«¯ä¼šä¸ Docker å®ˆæŠ¤è¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚Docker å®ˆæŠ¤è¿›ç¨‹ä¼šå¤„ç†å¤æ‚ç¹é‡çš„ä»»åŠ¡ï¼Œä¾‹å¦‚å»ºç«‹ã€è¿è¡Œã€å‘å¸ƒä½ çš„ D">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://static.open-open.com/lib/uploadImg/20150212/20150212091033_189.png">
<meta property="og:image" content="http://static.open-open.com/lib/uploadImg/20150212/20150212091034_223.png">
<meta property="og:image" content="http://static.open-open.com/lib/uploadImg/20150212/20150212091034_634.png">
<meta property="og:image" content="http://static.open-open.com/lib/uploadImg/20150212/20150212091035_252.png">
<meta property="og:image" content="http://static.open-open.com/lib/uploadImg/20150212/20150212091035_900.png">
<meta property="og:image" content="http://static.open-open.com/lib/uploadImg/20150212/20150212091035_912.png">
<meta property="article:published_time" content="2016-08-06T14:26:56.000Z">
<meta property="article:modified_time" content="2023-05-12T16:15:13.971Z">
<meta property="article:author" content="Tung7">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://static.open-open.com/lib/uploadImg/20150212/20150212091033_189.png">
  
  
  
  <title>éå¸¸è¯¦ç»†çš„Dockerå­¦ä¹ ç¬”è®° - Tungçš„ä¸ªäººä¸»é¡µ</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"www.tung7.com","root":"/","version":"1.9.4","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.0.0-rc1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 50vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Tung7</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="2iconfont 2icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="2iconfont 2icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="2iconfont 2icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="2iconfont 2icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" false
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle">éå¸¸è¯¦ç»†çš„Dockerå­¦ä¹ ç¬”è®°</span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Tung
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2016-08-06 22:26" pubdate>
          22:26 August 6, 2016
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid post-container nopadding-x">
  <div class="side-col side-col-post-left" style="padding-top:0!important;"></div>
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2 side-col-post-left" style="padding-top:0!important;">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="ä»–å±±ä¹‹çŸ³"
        id="heading-560b6e30e9355efbb4706b7eedbf6b2c" role="tab" data-toggle="collapse" href="#collapse-560b6e30e9355efbb4706b7eedbf6b2c"
        aria-expanded="true"
      >ğŸ“ä»–å±±ä¹‹çŸ³
        <span class="list-group-count">(4)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-560b6e30e9355efbb4706b7eedbf6b2c"
           role="tabpanel" aria-labelledby="heading-560b6e30e9355efbb4706b7eedbf6b2c">
        
        
          
  <div class="category-post-list">

    
    
      

      

      

      
        <a href="/%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3/detail_docker_study_note.html" title="éå¸¸è¯¦ç»†çš„Dockerå­¦ä¹ ç¬”è®°"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">ğŸ“„éå¸¸è¯¦ç»†çš„Dockerå­¦ä¹ ç¬”è®°</span>
        </a>
      
    
      

      

      

      
        <a href="/%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3/introduction_swarm.html" title="æ·±å…¥æµ…å‡ºSwarm"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">ğŸ“„æ·±å…¥æµ…å‡ºSwarm</span>
        </a>
      
    
      

      

      

      
        <a href="/%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3/DDD%E5%B3%B0%E4%BC%9A2020%E6%91%98%E5%BD%95.html" title="DDDå³°ä¼š2020æ‘˜å½•"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">ğŸ“„DDDå³°ä¼š2020æ‘˜å½•</span>
        </a>
      
    
      

      

      
        
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <div id="post-icon">ğŸ“</div>
          <article class="post-content mx-auto">
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
<!--      <i class="iconfont icon-books"></i>-->
        ğŸ—‚ï¸

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3/" class="category-chain-item"   >ä»–å±±ä¹‹çŸ³</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
<!--      <i class="iconfont icon-tags"></i>-->
        ğŸ·ï¸
        <a href="/tags/docker/">#docker</a>
      
    </div>
  
</div>

            </div>
            <hr style="border-bottom: 2px solid #b18082">
            <!-- SEO header -->
            <h1 style="display: none">éå¸¸è¯¦ç»†çš„Dockerå­¦ä¹ ç¬”è®°</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="ä¸€ã€Docker-ç®€ä»‹"><a class="header-anchor" href="#ä¸€ã€Docker-ç®€ä»‹"></a>ä¸€ã€Docker ç®€ä»‹</h1>
<p>Docker ä¸¤ä¸ªä¸»è¦éƒ¨ä»¶ï¼š</p>
<ul>
<li>Docker: å¼€æºçš„å®¹å™¨è™šæ‹ŸåŒ–å¹³å°</li>
<li>Docker Hub: ç”¨äºåˆ†äº«ã€ç®¡ç† Docker å®¹å™¨çš„ Docker SaaS å¹³å° â€“Â <a target="_blank" rel="noopener" href="https://registry.hub.docker.com/search?q=library">Docker Hub</a></li>
</ul>
<p>Docker ä½¿ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨ (C/S) æ¶æ„æ¨¡å¼ã€‚Docker å®¢æˆ·ç«¯ä¼šä¸ Docker å®ˆæŠ¤è¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚Docker å®ˆæŠ¤è¿›ç¨‹ä¼šå¤„ç†å¤æ‚ç¹é‡çš„ä»»åŠ¡ï¼Œä¾‹å¦‚å»ºç«‹ã€è¿è¡Œã€å‘å¸ƒä½ çš„ Docker å®¹å™¨ã€‚Docker å®¢æˆ·ç«¯å’Œå®ˆæŠ¤è¿›ç¨‹å¯ä»¥è¿è¡Œåœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸Šï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Docker å®¢æˆ·ç«¯å»è¿æ¥ä¸€ä¸ªè¿œç¨‹çš„ Docker å®ˆæŠ¤è¿›ç¨‹ã€‚Docker å®¢æˆ·ç«¯å’Œå®ˆæŠ¤è¿›ç¨‹ä¹‹é—´é€šè¿‡ socket æˆ–è€… RESTful API è¿›è¡Œé€šä¿¡ã€‚</p>
<p><img src="http://static.open-open.com/lib/uploadImg/20150212/20150212091033_189.png" srcset="/img/loading.gif" lazyload alt="éå¸¸è¯¦ç»†çš„ Docker å­¦ä¹ ç¬”è®°"></p>
<h2 id="1-1-Docker-å®ˆæŠ¤è¿›ç¨‹"><a class="header-anchor" href="#1-1-Docker-å®ˆæŠ¤è¿›ç¨‹"></a>1.1 Docker å®ˆæŠ¤è¿›ç¨‹</h2>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒDocker å®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸€å°ä¸»æœºä¸Šã€‚ç”¨æˆ·å¹¶ä¸ç›´æ¥å’Œå®ˆæŠ¤è¿›ç¨‹è¿›è¡Œäº¤äº’ï¼Œè€Œæ˜¯é€šè¿‡ Docker å®¢æˆ·ç«¯é—´æ¥å’Œå…¶é€šä¿¡ã€‚</p>
<h2 id="1-2-Docker-å®¢æˆ·ç«¯"><a class="header-anchor" href="#1-2-Docker-å®¢æˆ·ç«¯"></a>1.2 Docker å®¢æˆ·ç«¯</h2>
<p>Docker å®¢æˆ·ç«¯ï¼Œå®é™…ä¸Šæ˜¯ docker çš„äºŒè¿›åˆ¶ç¨‹åºï¼Œæ˜¯ä¸»è¦çš„ç”¨æˆ·ä¸ Docker äº¤äº’æ–¹å¼ã€‚å®ƒæ¥æ”¶ç”¨æˆ·æŒ‡ä»¤å¹¶ä¸”ä¸èƒŒåçš„ Docker å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ï¼Œå¦‚æ­¤æ¥å›å¾€å¤ã€‚</p>
<h2 id="1-3-Docker-å†…éƒ¨"><a class="header-anchor" href="#1-3-Docker-å†…éƒ¨"></a>1.3 Docker å†…éƒ¨</h2>
<p>è¦ç†è§£ Docker å†…éƒ¨æ„å»ºï¼Œéœ€è¦ç†è§£ä»¥ä¸‹ä¸‰ç§éƒ¨ä»¶ï¼š</p>
<ul>
<li>Docker é•œåƒ - Docker images</li>
<li>Docker ä»“åº“ - Docker registeries</li>
<li>Docker å®¹å™¨ - Docker containers</li>
</ul>
<h3 id="Docker-é•œåƒ"><a class="header-anchor" href="#Docker-é•œåƒ"></a>Docker é•œåƒ</h3>
<p>Docker é•œåƒæ˜¯ Docker å®¹å™¨è¿è¡Œæ—¶çš„åªè¯»æ¨¡æ¿ï¼Œæ¯ä¸€ä¸ªé•œåƒç”±ä¸€ç³»åˆ—çš„å±‚ (layers) ç»„æˆã€‚Docker ä½¿ç”¨ UnionFS æ¥å°†è¿™äº›å±‚è”åˆåˆ°å•ç‹¬çš„é•œåƒä¸­ã€‚UnionFS å…è®¸ç‹¬ç«‹æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹(ç§°ä¹‹ä¸ºåˆ†æ”¯)è¢«é€æ˜è¦†ç›–ï¼Œå½¢æˆä¸€ä¸ªå•ç‹¬è¿è´¯çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ­£å› ä¸ºæœ‰äº†è¿™äº›å±‚çš„å­˜åœ¨ï¼ŒDocker æ˜¯å¦‚æ­¤çš„è½»é‡ã€‚å½“ä½ æ”¹å˜äº†ä¸€ä¸ª Docker é•œåƒï¼Œæ¯”å¦‚å‡çº§åˆ°æŸä¸ªç¨‹åºåˆ°æ–°çš„ç‰ˆæœ¬ï¼Œä¸€ä¸ªæ–°çš„å±‚ä¼šè¢«åˆ›å»ºã€‚å› æ­¤ï¼Œä¸ç”¨æ›¿æ¢æ•´ä¸ªåŸå…ˆçš„é•œåƒæˆ–è€…é‡æ–°å»ºç«‹(åœ¨ä½¿ç”¨è™šæ‹Ÿæœºçš„æ—¶å€™ä½ å¯èƒ½ä¼šè¿™ä¹ˆåš)ï¼Œåªæ˜¯ä¸€ä¸ªæ–° çš„å±‚è¢«æ·»åŠ æˆ–å‡çº§äº†ã€‚ç°åœ¨ä½ ä¸ç”¨é‡æ–°å‘å¸ƒæ•´ä¸ªé•œåƒï¼Œåªéœ€è¦å‡çº§ï¼Œå±‚ä½¿å¾—åˆ†å‘ Docker é•œåƒå˜å¾—ç®€å•å’Œå¿«é€Ÿã€‚</p>
<h3 id="Docker-ä»“åº“"><a class="header-anchor" href="#Docker-ä»“åº“"></a>Docker ä»“åº“</h3>
<p>Docker ä»“åº“ç”¨æ¥ä¿å­˜é•œåƒï¼Œå¯ä»¥ç†è§£ä¸ºä»£ç æ§åˆ¶ä¸­çš„ä»£ç ä»“åº“ã€‚åŒæ ·çš„ï¼ŒDocker ä»“åº“ä¹Ÿæœ‰å…¬æœ‰å’Œç§æœ‰çš„æ¦‚å¿µã€‚å…¬æœ‰çš„ Docker ä»“åº“åå­—æ˜¯ Docker Hubã€‚Docker Hub æä¾›äº†åºå¤§çš„é•œåƒé›†åˆä¾›ä½¿ç”¨ã€‚è¿™äº›é•œåƒå¯ä»¥æ˜¯è‡ªå·±åˆ›å»ºï¼Œæˆ–è€…åœ¨åˆ«äººçš„é•œåƒåŸºç¡€ä¸Šåˆ›å»ºã€‚Docker ä»“åº“æ˜¯ Docker çš„åˆ†å‘éƒ¨åˆ†ã€‚</p>
<h3 id="Docker-å®¹å™¨"><a class="header-anchor" href="#Docker-å®¹å™¨"></a>Docker å®¹å™¨</h3>
<p>Docker å®¹å™¨å’Œæ–‡ä»¶å¤¹å¾ˆç±»ä¼¼ï¼Œä¸€ä¸ªDockerå®¹å™¨åŒ…å«äº†æ‰€æœ‰çš„æŸä¸ªåº”ç”¨è¿è¡Œæ‰€éœ€è¦çš„ç¯å¢ƒã€‚æ¯ä¸€ä¸ª Docker å®¹å™¨éƒ½æ˜¯ä» Docker é•œåƒåˆ›å»ºçš„ã€‚Docker å®¹å™¨å¯ä»¥è¿è¡Œã€å¼€å§‹ã€åœæ­¢ã€ç§»åŠ¨å’Œåˆ é™¤ã€‚æ¯ä¸€ä¸ª Docker å®¹å™¨éƒ½æ˜¯ç‹¬ç«‹å’Œå®‰å…¨çš„åº”ç”¨å¹³å°ï¼ŒDocker å®¹å™¨æ˜¯ Docker çš„è¿è¡Œéƒ¨åˆ†ã€‚</p>
<h2 id="1-4-libcontainer"><a class="header-anchor" href="#1-4-libcontainer"></a>1.4 libcontainer</h2>
<p>Docker ä» 0.9 ç‰ˆæœ¬å¼€å§‹ä½¿ç”¨ libcontainer æ›¿ä»£ lxcï¼Œlibcontainer å’Œ Linux ç³»ç»Ÿçš„äº¤äº’å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://static.open-open.com/lib/uploadImg/20150212/20150212091034_223.png" srcset="/img/loading.gif" lazyload alt="éå¸¸è¯¦ç»†çš„ Docker å­¦ä¹ ç¬”è®°"></p>
<ul>
<li>å›¾ç‰‡æ¥æº:Â <a target="_blank" rel="noopener" href="http://blog.docker.com/2014/03/docker-0-9-introducing-execution-drivers-and-libcontainer/">Docker 0.9: introducing execution drivers and libcontainer</a></li>
</ul>
<h2 id="1-5-å‘½åç©ºé—´ã€ŒNamespacesã€"><a class="header-anchor" href="#1-5-å‘½åç©ºé—´ã€ŒNamespacesã€"></a>1.5 å‘½åç©ºé—´ã€ŒNamespacesã€</h2>
<h3 id="pid-namespace"><a class="header-anchor" href="#pid-namespace"></a>pid namespace</h3>
<p>ä¸åŒç”¨æˆ·çš„è¿›ç¨‹å°±æ˜¯é€šè¿‡ pid namespace éš”ç¦»å¼€çš„ï¼Œä¸”ä¸åŒ namespace ä¸­å¯ä»¥æœ‰ç›¸åŒ PIDã€‚å…·æœ‰ä»¥ä¸‹ç‰¹å¾:</p>
<ul>
<li>æ¯ä¸ª namespace ä¸­çš„ pid æ˜¯æœ‰è‡ªå·±çš„ pid=1 çš„è¿›ç¨‹(ç±»ä¼¼ /sbin/init è¿›ç¨‹)</li>
<li>æ¯ä¸ª namespace ä¸­çš„è¿›ç¨‹åªèƒ½å½±å“è‡ªå·±çš„åŒä¸€ä¸ª namespace æˆ–å­ namespace ä¸­çš„è¿›ç¨‹</li>
<li>å› ä¸º /proc åŒ…å«æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œå› æ­¤åœ¨ container ä¸­çš„ pseudo-filesystem çš„ /proc ç›®å½•åªèƒ½çœ‹åˆ°è‡ªå·± namespace ä¸­çš„è¿›ç¨‹</li>
<li>å› ä¸º namespace å…è®¸åµŒå¥—ï¼Œçˆ¶ namespace å¯ä»¥å½±å“å­ namespace çš„è¿›ç¨‹ï¼Œæ‰€ä»¥å­ namespace çš„è¿›ç¨‹å¯ä»¥åœ¨çˆ¶ namespace ä¸­çœ‹åˆ°ï¼Œä½†æ˜¯å…·æœ‰ä¸åŒçš„ pid</li>
</ul>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://blog.jtlebi.fr/2014/01/05/introduction-to-linux-namespaces-part-3-pid/">Introduction to Linux namespaces â€“ Part 3: PID</a></p>
<h3 id="mnt-namespace"><a class="header-anchor" href="#mnt-namespace"></a>mnt namespace</h3>
<p>ç±»ä¼¼ chrootï¼Œå°†ä¸€ä¸ªè¿›ç¨‹æ”¾åˆ°ä¸€ä¸ªç‰¹å®šçš„ç›®å½•æ‰§è¡Œã€‚mnt namespace å…è®¸ä¸åŒ namespace çš„è¿›ç¨‹çœ‹åˆ°çš„æ–‡ä»¶ç»“æ„ä¸åŒï¼Œè¿™æ ·æ¯ä¸ª namespace ä¸­çš„è¿›ç¨‹æ‰€çœ‹åˆ°çš„æ–‡ä»¶ç›®å½•å°±è¢«éš”ç¦»å¼€äº†ã€‚åŒ chroot ä¸åŒï¼Œæ¯ä¸ª namespace ä¸­çš„ container åœ¨ /proc/mounts çš„ä¿¡æ¯åªåŒ…å«æ‰€åœ¨ namespace çš„ mount pointã€‚</p>
<h3 id="net-namespace"><a class="header-anchor" href="#net-namespace"></a>net namespace</h3>
<p>ç½‘ç»œéš”ç¦»æ˜¯é€šè¿‡ net namespace å®ç°çš„ï¼Œ æ¯ä¸ª net namespace æœ‰ç‹¬ç«‹çš„ network devices, IP addresses, IP routing tables, /proc/net ç›®å½•ã€‚è¿™æ ·æ¯ä¸ª container çš„ç½‘ç»œå°±èƒ½éš”ç¦»å¼€æ¥ã€‚ docker é»˜è®¤é‡‡ç”¨ veth çš„æ–¹å¼å°† container ä¸­çš„è™šæ‹Ÿç½‘å¡åŒ host ä¸Šçš„ä¸€ä¸ª docker bridge è¿æ¥åœ¨ä¸€èµ·ã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://blog.jtlebi.fr/2014/01/19/introduction-to-linux-namespaces-part-5-net/">Introduction to Linux namespaces â€“ Part 5: NET</a></p>
<h3 id="uts-namespace"><a class="header-anchor" href="#uts-namespace"></a>uts namespace</h3>
<p>UTS (â€œUNIX Time-sharing Systemâ€) namespace å…è®¸æ¯ä¸ª container æ‹¥æœ‰ç‹¬ç«‹çš„ hostname å’Œ domain name, ä½¿å…¶åœ¨ç½‘ç»œä¸Šå¯ä»¥è¢«è§†ä½œä¸€ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹è€Œé Host ä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://blog.jtlebi.fr/2013/12/22/introduction-to-linux-namespaces-part-1-uts/">Introduction to Linux namespaces â€“ Part 1: UTS</a></p>
<h3 id="ipc-namespace"><a class="header-anchor" href="#ipc-namespace"></a>ipc namespace</h3>
<p>container ä¸­è¿›ç¨‹äº¤äº’è¿˜æ˜¯é‡‡ç”¨ Linux å¸¸è§çš„è¿›ç¨‹é—´äº¤äº’æ–¹æ³• (interprocess communication - IPC), åŒ…æ‹¬å¸¸è§çš„ä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œå…±äº«å†…å­˜ã€‚ç„¶è€ŒåŒ VM ä¸åŒï¼Œcontainer çš„è¿›ç¨‹é—´äº¤äº’å®é™…ä¸Šè¿˜æ˜¯ host ä¸Šå…·æœ‰ç›¸åŒ pid namespace ä¸­çš„è¿›ç¨‹é—´äº¤äº’ï¼Œå› æ­¤éœ€è¦åœ¨IPCèµ„æºç”³è¯·æ—¶åŠ å…¥ namespace ä¿¡æ¯ - æ¯ä¸ª IPC èµ„æºæœ‰ä¸€ä¸ªå”¯ä¸€çš„ 32bit IDã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://blog.jtlebi.fr/2013/12/28/introduction-to-linux-namespaces-part-2-ipc/">Introduction to Linux namespaces â€“ Part 2: IPC</a></p>
<h3 id="user-namespace"><a class="header-anchor" href="#user-namespace"></a>user namespace</h3>
<p>æ¯ä¸ª container å¯ä»¥æœ‰ä¸åŒçš„ user å’Œ group id, ä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä»¥ container å†…éƒ¨çš„ç”¨æˆ·åœ¨ container å†…éƒ¨æ‰§è¡Œç¨‹åºè€Œé Host ä¸Šçš„ç”¨æˆ·ã€‚</p>
<p>æœ‰äº†ä»¥ä¸Š 6 ç§ namespace ä»è¿›ç¨‹ã€ç½‘ç»œã€IPCã€æ–‡ä»¶ç³»ç»Ÿã€UTS å’Œç”¨æˆ·è§’åº¦çš„éš”ç¦»ï¼Œä¸€ä¸ª container å°±å¯ä»¥å¯¹å¤–å±•ç°å‡ºä¸€ä¸ªç‹¬ç«‹è®¡ç®—æœºçš„èƒ½åŠ›ï¼Œå¹¶ä¸”ä¸åŒ container ä» OS å±‚é¢å®ç°äº†éš”ç¦»ã€‚ ç„¶è€Œä¸åŒ namespace ä¹‹é—´èµ„æºè¿˜æ˜¯ç›¸äº’ç«äº‰çš„ï¼Œä»ç„¶éœ€è¦ç±»ä¼¼ ulimit æ¥ç®¡ç†æ¯ä¸ª container æ‰€èƒ½ä½¿ç”¨çš„èµ„æº - cgroupã€‚</p>
<h3 id="Reference"><a class="header-anchor" href="#Reference"></a>Reference</h3>
<ul>
<li><a target="_blank" rel="noopener" href="http://tiewei.github.io/cloud/Docker-Getting-Start/">Docker Getting Start: Related Knowledge</a></li>
<li><a target="_blank" rel="noopener" href="https://ruby-china.org/topics/22004">Docker ä»‹ç»ä»¥åŠå…¶ç›¸å…³æœ¯è¯­ã€åº•å±‚åŸç†å’ŒæŠ€æœ¯</a></li>
</ul>
<h2 id="1-6-èµ„æºé…é¢ã€Œcgroupsã€"><a class="header-anchor" href="#1-6-èµ„æºé…é¢ã€Œcgroupsã€"></a>1.6 èµ„æºé…é¢ã€Œcgroupsã€</h2>
<p>cgroups å®ç°äº†å¯¹èµ„æºçš„é…é¢å’Œåº¦é‡ã€‚ cgroups çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œæä¾›ç±»ä¼¼æ–‡ä»¶çš„æ¥å£ï¼Œåœ¨ /cgroup ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å³å¯æ–°å»ºä¸€ä¸ª groupï¼Œåœ¨æ­¤æ–‡ä»¶å¤¹ä¸­æ–°å»º task æ–‡ä»¶ï¼Œå¹¶å°† pid å†™å…¥è¯¥æ–‡ä»¶ï¼Œå³å¯å®ç°å¯¹è¯¥è¿›ç¨‹çš„èµ„æºæ§åˆ¶ã€‚å…·ä½“çš„èµ„æºé…ç½®é€‰é¡¹å¯ä»¥åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­æ–°å»ºå­ subsystem ï¼Œ{å­ç³»ç»Ÿå‰ç¼€}.{èµ„æºé¡¹} æ˜¯å…¸å‹çš„é…ç½®æ–¹æ³•ï¼Œ å¦‚ memory.usageinbytes å°±å®šä¹‰äº†è¯¥ group åœ¨ subsystem memory ä¸­çš„ä¸€ä¸ªå†…å­˜é™åˆ¶é€‰é¡¹ã€‚ å¦å¤–ï¼Œcgroups ä¸­çš„ subsystem å¯ä»¥éšæ„ç»„åˆï¼Œä¸€ä¸ª subsystem å¯ä»¥åœ¨ä¸åŒçš„ group ä¸­ï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ª group åŒ…å«å¤šä¸ª subsystem - ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª subsystemã€‚</p>
<ul>
<li>memory
<ul>
<li>å†…å­˜ç›¸å…³çš„é™åˆ¶</li>
</ul>
</li>
<li>cpu
<ul>
<li>åœ¨ cgroup ä¸­ï¼Œå¹¶ä¸èƒ½åƒç¡¬ä»¶è™šæ‹ŸåŒ–æ–¹æ¡ˆä¸€æ ·èƒ½å¤Ÿå®šä¹‰ CPU èƒ½åŠ›ï¼Œä½†æ˜¯èƒ½å¤Ÿå®šä¹‰ CPU è½®è½¬çš„ä¼˜å…ˆçº§ï¼Œå› æ­¤å…·æœ‰è¾ƒé«˜ CPU ä¼˜å…ˆçº§çš„è¿›ç¨‹ä¼šæ›´å¯èƒ½å¾—åˆ° CPU è¿ç®—ã€‚ é€šè¿‡å°†å‚æ•°å†™å…¥ cpu.shares ,å³å¯å®šä¹‰æ”¹ cgroup çš„ CPU ä¼˜å…ˆçº§ - è¿™é‡Œæ˜¯ä¸€ä¸ªç›¸å¯¹æƒé‡ï¼Œè€Œéç»å¯¹å€¼</li>
</ul>
</li>
<li>blkio
<ul>
<li>block IO ç›¸å…³çš„ç»Ÿè®¡å’Œé™åˆ¶ï¼Œbyte/operation ç»Ÿè®¡å’Œé™åˆ¶ (IOPS ç­‰)ï¼Œè¯»å†™é€Ÿåº¦é™åˆ¶ç­‰ï¼Œä½†æ˜¯è¿™é‡Œä¸»è¦ç»Ÿè®¡çš„éƒ½æ˜¯åŒæ­¥ IO</li>
</ul>
</li>
<li>devices
<ul>
<li>è®¾å¤‡æƒé™é™åˆ¶</li>
</ul>
</li>
</ul>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="http://tiewei.github.io/devops/howto-use-cgroup/">how to use cgroup</a></p>
<h1 id="äºŒã€Docker-å®‰è£…"><a class="header-anchor" href="#äºŒã€Docker-å®‰è£…"></a>äºŒã€Docker å®‰è£…</h1>
<p>docker çš„ç›¸å…³å®‰è£…æ–¹æ³•è¿™é‡Œä¸ä½œä»‹ç»ï¼Œå…·ä½“å®‰è£…å‚è€ƒÂ <a target="_blank" rel="noopener" href="https://docs.docker.com/installation/">å®˜æ¡£</a></p>
<p>è·å–å½“å‰ docker ç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker version<br>Client version: 1.3.2<br>Client API version: 1.15<br>Go version (client): go1.3.3<br>Git commit (client): 39fa2fa/1.3.2<br>OS/Arch (client): linux/amd64<br>Server version: 1.3.2<br>Server API version: 1.15<br>Go version (server): go1.3.3<br>Git commit (server): 39fa2fa/1.3.2<br></code></pre></td></tr></table></figure>
<h1 id="ä¸‰ã€Docker-åŸºç¡€ç”¨æ³•"><a class="header-anchor" href="#ä¸‰ã€Docker-åŸºç¡€ç”¨æ³•"></a>ä¸‰ã€Docker åŸºç¡€ç”¨æ³•</h1>
<p><a target="_blank" rel="noopener" href="https://registry.hub.docker.com/">Docker HUB</a>Â : Dockeré•œåƒé¦–é¡µï¼ŒåŒ…æ‹¬å®˜æ–¹é•œåƒå’Œå…¶å®ƒå…¬å¼€é•œåƒ</p>
<p>å› ä¸ºå›½æƒ…çš„åŸå› ï¼Œå›½å†…ä¸‹è½½ Docker HUB å®˜æ–¹çš„ç›¸å…³é•œåƒæ¯”è¾ƒæ…¢ï¼Œå¯ä»¥ä½¿ç”¨Â <a target="_blank" rel="noopener" href="http://opskumu.github.io/docker.cn">docker.cn</a>Â é•œåƒï¼Œé•œåƒä¿æŒå’Œå®˜æ–¹ä¸€è‡´ï¼Œå…³é”®æ˜¯é€Ÿåº¦å—ï¼Œæ¨èä½¿ç”¨ã€‚</p>
<h2 id="3-1-Search-images"><a class="header-anchor" href="#3-1-Search-images"></a>3.1 Search images</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker search ubuntu<br></code></pre></td></tr></table></figure>
<h2 id="3-2-Pull-images"><a class="header-anchor" href="#3-2-Pull-images"></a>3.2 Pull images</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker pull ubuntu <span class="hljs-comment"># è·å– ubuntu å®˜æ–¹é•œåƒ </span><br>$ sudo docker images <span class="hljs-comment"># æŸ¥çœ‹å½“å‰é•œåƒåˆ—è¡¨ </span><br></code></pre></td></tr></table></figure>
<h2 id="3-3-Running-an-interactive-shell"><a class="header-anchor" href="#3-3-Running-an-interactive-shell"></a>3.3 Running an interactive shell</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -i -t ubuntu:14.04 /bin/bash<br></code></pre></td></tr></table></figure>
<ul>
<li>docker run - è¿è¡Œä¸€ä¸ªå®¹å™¨</li>
<li>-t - åˆ†é…ä¸€ä¸ªï¼ˆä¼ªï¼‰tty (link is external)</li>
<li>-i - äº¤äº’æ¨¡å¼ (so we can interact with it)</li>
<li>ubuntu:14.04 - ä½¿ç”¨ ubuntu åŸºç¡€é•œåƒ 14.04</li>
<li>/bin/bash - è¿è¡Œå‘½ä»¤ bash shell</li>
</ul>
<p>æ³¨: ubuntu ä¼šæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œé€šè¿‡æŒ‡å®š tag æ¥å¯åŠ¨ç‰¹å®šçš„ç‰ˆæœ¬ [image]:[tag]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker ps <span class="hljs-comment"># æŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨, ps -a åˆ—å‡ºå½“å‰ç³»ç»Ÿæ‰€æœ‰çš„å®¹å™¨ </span><br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES<br>6c9129e9df10        ubuntu:14.04        /bin/bash 6 minutes ago       Up 6 minutes                            cranky_babbage<br></code></pre></td></tr></table></figure>
<h2 id="3-4-ç›¸å…³å¿«æ·é”®"><a class="header-anchor" href="#3-4-ç›¸å…³å¿«æ·é”®"></a>3.4 ç›¸å…³å¿«æ·é”®</h2>
<ul>
<li>é€€å‡ºï¼šCtrl-Dorexit</li>
<li>detachï¼šCtrl-P + Ctrl-Q</li>
<li>attach:docker attach CONTAINER-ID</li>
</ul>
<h1 id="å››ã€Docker-å‘½ä»¤å¸®åŠ©"><a class="header-anchor" href="#å››ã€Docker-å‘½ä»¤å¸®åŠ©"></a>å››ã€Docker å‘½ä»¤å¸®åŠ©</h1>
<h2 id="4-1-docker-help"><a class="header-anchor" href="#4-1-docker-help"></a>4.1 docker help</h2>
<h3 id="docker-command"><a class="header-anchor" href="#docker-command"></a>docker command</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker   <span class="hljs-comment"># docker å‘½ä»¤å¸®åŠ©</span><br>Commands:<br>    attach    Attach to a running container                 <span class="hljs-comment"># å½“å‰ shell ä¸‹ attach è¿æ¥æŒ‡å®šè¿è¡Œé•œåƒ</span><br>    build     Build an image from a Dockerfile              <span class="hljs-comment"># é€šè¿‡ Dockerfile å®šåˆ¶é•œåƒ</span><br>    commit    Create a new image from a container<span class="hljs-string">&#x27;s changes # æäº¤å½“å‰å®¹å™¨ä¸ºæ–°çš„é•œåƒ</span><br><span class="hljs-string">    cp        Copy files/folders from the containers filesystem to the host path</span><br><span class="hljs-string">              # ä»å®¹å™¨ä¸­æ‹·è´æŒ‡å®šæ–‡ä»¶æˆ–è€…ç›®å½•åˆ°å®¿ä¸»æœºä¸­</span><br><span class="hljs-string">    create    Create a new container                        # åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ŒåŒ runï¼Œä½†ä¸å¯åŠ¨å®¹å™¨</span><br><span class="hljs-string">    diff      Inspect changes on a container&#x27;</span>s filesystem   <span class="hljs-comment"># æŸ¥çœ‹ docker å®¹å™¨å˜åŒ–</span><br>    events    Get real time events from the server          <span class="hljs-comment"># ä» docker æœåŠ¡è·å–å®¹å™¨å®æ—¶äº‹ä»¶</span><br>    <span class="hljs-built_in">exec</span>      Run a <span class="hljs-built_in">command</span> <span class="hljs-keyword">in</span> an existing container        <span class="hljs-comment"># åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸Šè¿è¡Œå‘½ä»¤</span><br>    <span class="hljs-built_in">export</span>    Stream the contents of a container as a tar archive   <br>              <span class="hljs-comment"># å¯¼å‡ºå®¹å™¨çš„å†…å®¹æµä½œä¸ºä¸€ä¸ª tar å½’æ¡£æ–‡ä»¶[å¯¹åº” import ]</span><br>    <span class="hljs-built_in">history</span>   Show the <span class="hljs-built_in">history</span> of an image                  <span class="hljs-comment"># å±•ç¤ºä¸€ä¸ªé•œåƒå½¢æˆå†å²</span><br>    images    List images                                   <span class="hljs-comment"># åˆ—å‡ºç³»ç»Ÿå½“å‰é•œåƒ</span><br>    import    Create a new filesystem image from the contents of a tarball  <br>              <span class="hljs-comment"># ä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿæ˜ åƒ[å¯¹åº” export]</span><br>    info      Display system-wide information               <span class="hljs-comment"># æ˜¾ç¤ºç³»ç»Ÿç›¸å…³ä¿¡æ¯</span><br>    inspect   Return low-level information on a container   <span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</span><br>    <span class="hljs-built_in">kill</span>      Kill a running container                      <span class="hljs-comment"># kill æŒ‡å®š docker å®¹å™¨</span><br>    load      Load an image from a tar archive              <span class="hljs-comment"># ä»ä¸€ä¸ª tar åŒ…ä¸­åŠ è½½ä¸€ä¸ªé•œåƒ[å¯¹åº” save]</span><br>    login     Register or Login to the docker registry server   <br>              <span class="hljs-comment"># æ³¨å†Œæˆ–è€…ç™»é™†ä¸€ä¸ª docker æºæœåŠ¡å™¨</span><br>    <span class="hljs-built_in">logout</span>    Log out from a Docker registry server         <span class="hljs-comment"># ä»å½“å‰ Docker registry é€€å‡º</span><br>    logs      Fetch the logs of a container                 <span class="hljs-comment"># è¾“å‡ºå½“å‰å®¹å™¨æ—¥å¿—ä¿¡æ¯</span><br>    port      Lookup the public-facing port <span class="hljs-built_in">which</span> is NAT-ed to PRIVATE_PORT<br>              <span class="hljs-comment"># æŸ¥çœ‹æ˜ å°„ç«¯å£å¯¹åº”çš„å®¹å™¨å†…éƒ¨æºç«¯å£</span><br>    pause     Pause all processes within a container        <span class="hljs-comment"># æš‚åœå®¹å™¨</span><br>    ps        List containers                               <span class="hljs-comment"># åˆ—å‡ºå®¹å™¨åˆ—è¡¨</span><br>    pull      Pull an image or a repository from the docker registry server<br>              <span class="hljs-comment"># ä»dockeré•œåƒæºæœåŠ¡å™¨æ‹‰å–æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒ</span><br>    push      Push an image or a repository to the docker registry server<br>              <span class="hljs-comment"># æ¨é€æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒè‡³dockeræºæœåŠ¡å™¨</span><br>    restart   Restart a running container                   <span class="hljs-comment"># é‡å¯è¿è¡Œçš„å®¹å™¨</span><br>    <span class="hljs-built_in">rm</span>        Remove one or more containers                 <span class="hljs-comment"># ç§»é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨</span><br>    rmi       Remove one or more images                 <br>              <span class="hljs-comment"># ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ[æ— å®¹å™¨ä½¿ç”¨è¯¥é•œåƒæ‰å¯åˆ é™¤ï¼Œå¦åˆ™éœ€åˆ é™¤ç›¸å…³å®¹å™¨æ‰å¯ç»§ç»­æˆ– -f å¼ºåˆ¶åˆ é™¤]</span><br>    run       Run a <span class="hljs-built_in">command</span> <span class="hljs-keyword">in</span> a new container<br>              <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤</span><br>    save      Save an image to a tar archive                <span class="hljs-comment"># ä¿å­˜ä¸€ä¸ªé•œåƒä¸ºä¸€ä¸ª tar åŒ…[å¯¹åº” load]</span><br>    search    Search <span class="hljs-keyword">for</span> an image on the Docker Hub         <span class="hljs-comment"># åœ¨ docker hub ä¸­æœç´¢é•œåƒ</span><br>    start     Start a stopped containers                    <span class="hljs-comment"># å¯åŠ¨å®¹å™¨</span><br>    stop      Stop a running containers                     <span class="hljs-comment"># åœæ­¢å®¹å™¨</span><br>    tag       Tag an image into a repository                <span class="hljs-comment"># ç»™æºä¸­é•œåƒæ‰“æ ‡ç­¾</span><br>    top       Lookup the running processes of a container   <span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯</span><br>    unpause   Unpause a paused container                    <span class="hljs-comment"># å–æ¶ˆæš‚åœå®¹å™¨</span><br>    version   Show the docker version information           <span class="hljs-comment"># æŸ¥çœ‹ docker ç‰ˆæœ¬å·</span><br>    <span class="hljs-built_in">wait</span>      Block until a container stops, <span class="hljs-keyword">then</span> <span class="hljs-built_in">print</span> its <span class="hljs-built_in">exit</span> code   <br>              <span class="hljs-comment"># æˆªå–å®¹å™¨åœæ­¢æ—¶çš„é€€å‡ºçŠ¶æ€å€¼</span><br>Run <span class="hljs-string">&#x27;docker COMMAND --help&#x27;</span> <span class="hljs-keyword">for</span> more information on a <span class="hljs-built_in">command</span>.<br></code></pre></td></tr></table></figure>
<h3 id="docker-option"><a class="header-anchor" href="#docker-option"></a>docker option</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">Usage of docker:<br>  --api-enable-cors=<span class="hljs-literal">false</span>                Enable CORS headers <span class="hljs-keyword">in</span> the remote API                      <span class="hljs-comment"># è¿œç¨‹ API ä¸­å¼€å¯ CORS å¤´</span><br>  -b, --bridge=<span class="hljs-string">&quot;&quot;</span>                        Attach containers to a pre-existing network bridge         <span class="hljs-comment"># æ¡¥æ¥ç½‘ç»œ</span><br>                                           use <span class="hljs-string">&#x27;none&#x27;</span> to <span class="hljs-built_in">disable</span> container networking<br>  --bip=<span class="hljs-string">&quot;&quot;</span>                               Use this CIDR notation address <span class="hljs-keyword">for</span> the network bridge<span class="hljs-string">&#x27;s IP, not compatible with -b</span><br><span class="hljs-string">                                         # å’Œ -b é€‰é¡¹ä¸å…¼å®¹ï¼Œå…·ä½“æ²¡æœ‰æµ‹è¯•è¿‡</span><br><span class="hljs-string">  -d, --daemon=false                     Enable daemon mode                                         # daemon æ¨¡å¼</span><br><span class="hljs-string">  -D, --debug=false                      Enable debug mode                                          # debug æ¨¡å¼</span><br><span class="hljs-string">  --dns=[]                               Force docker to use specific DNS servers                   # å¼ºåˆ¶ docker ä½¿ç”¨æŒ‡å®š dns æœåŠ¡å™¨</span><br><span class="hljs-string">  --dns-search=[]                        Force Docker to use specific DNS search domains            # å¼ºåˆ¶ docker ä½¿ç”¨æŒ‡å®š dns æœç´¢åŸŸ</span><br><span class="hljs-string">  -e, --exec-driver=&quot;native&quot;             Force the docker runtime to use a specific exec driver     # å¼ºåˆ¶ docker è¿è¡Œæ—¶ä½¿ç”¨æŒ‡å®šæ‰§è¡Œé©±åŠ¨å™¨</span><br><span class="hljs-string">  --fixed-cidr=&quot;&quot;                        IPv4 subnet for fixed IPs (ex: 10.20.0.0/16)</span><br><span class="hljs-string">                                           this subnet must be nested in the bridge subnet (which is defined by -b or --bip)</span><br><span class="hljs-string">  -G, --group=&quot;docker&quot;                   Group to assign the unix socket specified by -H when running in daemon mode</span><br><span class="hljs-string">                                           use &#x27;</span><span class="hljs-string">&#x27; (the empty string) to disable setting of a group</span><br><span class="hljs-string">  -g, --graph=&quot;/var/lib/docker&quot;          Path to use as the root of the docker runtime              # å®¹å™¨è¿è¡Œçš„æ ¹ç›®å½•è·¯å¾„</span><br><span class="hljs-string">  -H, --host=[]                          The socket(s) to bind to in daemon mode                    # daemon æ¨¡å¼ä¸‹ docker æŒ‡å®šç»‘å®šæ–¹å¼[tcp or æœ¬åœ° socket]</span><br><span class="hljs-string">                                           specified using one or more tcp://host:port, unix:///path/to/socket, fd://* or fd://socketfd.</span><br><span class="hljs-string">  --icc=true                             Enable inter-container communication                       # è·¨å®¹å™¨é€šä¿¡</span><br><span class="hljs-string">  --insecure-registry=[]                 Enable insecure communication with specified registries (no certificate verification for HTTPS and enable HTTP fallback) (e.g., localhost:5000 or 10.20.0.0/16)</span><br><span class="hljs-string">  --ip=&quot;0.0.0.0&quot;                         Default IP address to use when binding container ports     # æŒ‡å®šç›‘å¬åœ°å€ï¼Œé»˜è®¤æ‰€æœ‰ ip</span><br><span class="hljs-string">  --ip-forward=true                      Enable net.ipv4.ip_forward                                 # å¼€å¯è½¬å‘</span><br><span class="hljs-string">  --ip-masq=true                         Enable IP masquerading for bridge&#x27;</span>s IP range<br>  --iptables=<span class="hljs-literal">true</span>                        Enable Docker<span class="hljs-string">&#x27;s addition of iptables rules                 # æ·»åŠ å¯¹åº” iptables è§„åˆ™</span><br><span class="hljs-string">  --mtu=0                                Set the containers network MTU                             # è®¾ç½®ç½‘ç»œ mtu</span><br><span class="hljs-string">                                           if no value is provided: default to the default route MTU or 1500 if no default route is available</span><br><span class="hljs-string">  -p, --pidfile=&quot;/var/run/docker.pid&quot;    Path to use for daemon PID file                            # æŒ‡å®š pid æ–‡ä»¶ä½ç½®</span><br><span class="hljs-string">  --registry-mirror=[]                   Specify a preferred Docker registry mirror                  </span><br><span class="hljs-string">  -s, --storage-driver=&quot;&quot;                Force the docker runtime to use a specific storage driver  # å¼ºåˆ¶ docker è¿è¡Œæ—¶ä½¿ç”¨æŒ‡å®šå­˜å‚¨é©±åŠ¨</span><br><span class="hljs-string">  --selinux-enabled=false                Enable selinux support                                     # å¼€å¯ selinux æ”¯æŒ</span><br><span class="hljs-string">  --storage-opt=[]                       Set storage driver options                                 # è®¾ç½®å­˜å‚¨é©±åŠ¨é€‰é¡¹</span><br><span class="hljs-string">  --tls=false                            Use TLS; implied by tls-verify flags                       # å¼€å¯ tls</span><br><span class="hljs-string">  --tlscacert=&quot;/root/.docker/ca.pem&quot;     Trust only remotes providing a certificate signed by the CA given here</span><br><span class="hljs-string">  --tlscert=&quot;/root/.docker/cert.pem&quot;     Path to TLS certificate file                               # tls è¯ä¹¦æ–‡ä»¶ä½ç½®</span><br><span class="hljs-string">  --tlskey=&quot;/root/.docker/key.pem&quot;       Path to TLS key file                                       # tls key æ–‡ä»¶ä½ç½®</span><br><span class="hljs-string">  --tlsverify=false                      Use TLS and verify the remote (daemon: verify client, client: verify daemon) # ä½¿ç”¨ tls å¹¶ç¡®è®¤è¿œç¨‹æ§åˆ¶ä¸»æœº</span><br><span class="hljs-string">  -v, --version=false                    Print version information and quit                         # è¾“å‡º docker ç‰ˆæœ¬ä¿¡æ¯</span><br></code></pre></td></tr></table></figure>
<h2 id="4-2-docker-search"><a class="header-anchor" href="#4-2-docker-search"></a>4.2 docker search</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker search --<span class="hljs-built_in">help</span><br>Usage: docker search TERM<br>Search the Docker Hub <span class="hljs-keyword">for</span> images <span class="hljs-comment"># ä» Docker Hub æœç´¢é•œåƒ --automated=false Only show automated builds</span><br>  --no-trunc=<span class="hljs-literal">false</span> Don<span class="hljs-string">&#x27;t truncate output</span><br><span class="hljs-string">  -s, --stars=0 Only displays with at least xxx stars</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ sudo docker <span class="hljs-keyword">search</span> -s <span class="hljs-number">100</span> ubuntu # æŸ¥æ‰¾ star æ•°è‡³å°‘ä¸º <span class="hljs-number">100</span> çš„é•œåƒï¼Œæ‰¾å‡ºåªæœ‰å®˜æ–¹é•œåƒ <span class="hljs-keyword">start</span> æ•°è¶…è¿‡ <span class="hljs-number">100</span>ï¼Œé»˜è®¤ä¸åŠ  s é€‰é¡¹æ‰¾å‡ºæ‰€æœ‰ç›¸å…³ ubuntu é•œåƒ <br><span class="hljs-type">NAME</span>      DESCRIPTION                  STARS     OFFICIAL   AUTOMATED<br>ubuntu    Official Ubuntu base image <span class="hljs-number">425</span> [OK] <br></code></pre></td></tr></table></figure>
<h2 id="4-3-docker-info"><a class="header-anchor" href="#4-3-docker-info"></a>4.3 docker info</h2>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">$</span> <span class="hljs-string">sudo</span> <span class="hljs-string">docker</span> <span class="hljs-string">info</span> <br><span class="hljs-attr">Containers:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># å®¹å™¨ä¸ªæ•° </span><br><span class="hljs-attr">Images:</span> <span class="hljs-number">22</span> <span class="hljs-comment"># é•œåƒä¸ªæ•° </span><br><span class="hljs-attr">Storage Driver:</span> <span class="hljs-string">devicemapper</span> <span class="hljs-comment"># å­˜å‚¨é©±åŠ¨ </span><br><span class="hljs-attr">Pool Name:</span> <span class="hljs-string">docker-8:17-3221225728-pool</span><br><span class="hljs-attr">Pool Blocksize:</span> <span class="hljs-number">65.54</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Data file:</span> <span class="hljs-string">/data/docker/devicemapper/devicemapper/data</span><br><span class="hljs-attr">Metadata file:</span> <span class="hljs-string">/data/docker/devicemapper/devicemapper/metadata</span><br><span class="hljs-attr">Data Space Used:</span> <span class="hljs-number">1.83</span> <span class="hljs-string">GB</span><br> <span class="hljs-attr">Data Space Total:</span> <span class="hljs-number">107.4</span> <span class="hljs-string">GB</span><br><span class="hljs-attr">Metadata Space Used:</span> <span class="hljs-number">2.191</span> <span class="hljs-string">MB</span><br> <span class="hljs-attr">Metadata Space Total:</span> <span class="hljs-number">2.147</span> <span class="hljs-string">GB</span><br><span class="hljs-attr">Library Version:</span> <span class="hljs-number">1.02</span><span class="hljs-number">.84</span><span class="hljs-string">-RHEL7</span> <span class="hljs-string">(2014-03-26)</span> <span class="hljs-attr">Execution Driver:</span> <span class="hljs-string">native-0.2</span> <span class="hljs-comment"># å­˜å‚¨é©±åŠ¨ Kernel Version: 3.10.0-123.el7.x86_64</span><br><span class="hljs-attr">Operating System:</span> <span class="hljs-string">CentOS</span> <span class="hljs-string">Linux</span> <span class="hljs-number">7</span> <span class="hljs-string">(Core)</span> <br></code></pre></td></tr></table></figure>
<h2 id="4-4-docker-pull-docker-push"><a class="header-anchor" href="#4-4-docker-pull-docker-push"></a>4.4 docker pull &amp;&amp; docker push</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker pull --<span class="hljs-built_in">help</span> <span class="hljs-comment"># pull æ‹‰å–é•œåƒ </span><br>Usage: docker pull [OPTIONS] NAME[:TAG] Pull an image or a repository from the registry<br>-a, --all-tags=<span class="hljs-literal">false</span> Download all tagged images <span class="hljs-keyword">in</span> the repository <br><br>$ sudo docker push <span class="hljs-comment"># push æ¨é€æŒ‡å®šé•œåƒ </span><br>Usage: docker push NAME[:TAG] Push an image or a repository to the registry<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker pull ubuntu <span class="hljs-comment"># ä¸‹è½½å®˜æ–¹ ubuntu docker é•œåƒï¼Œé»˜è®¤ä¸‹è½½æ‰€æœ‰ ubuntu å®˜æ–¹åº“é•œåƒ </span><br>$ sudo docker pull ubuntu:14.04 <span class="hljs-comment"># ä¸‹è½½æŒ‡å®šç‰ˆæœ¬ ubuntu å®˜æ–¹é•œåƒ </span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker push 192.168.0.100:5000/ubuntu <span class="hljs-comment"># æ¨é€é•œåƒåº“åˆ°ç§æœ‰æº[å¯æ³¨å†Œ docker å®˜æ–¹è´¦æˆ·ï¼Œæ¨é€åˆ°å®˜æ–¹è‡ªæœ‰è´¦æˆ·] </span><br>$ sudo docker push 192.168.0.100:5000/ubuntu:14.04 <span class="hljs-comment"># æ¨é€æŒ‡å®šé•œåƒåˆ°ç§æœ‰æº </span><br></code></pre></td></tr></table></figure>
<h2 id="4-5-docker-images"><a class="header-anchor" href="#4-5-docker-images"></a>4.5 docker images</h2>
<p>åˆ—å‡ºå½“å‰ç³»ç»Ÿé•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker images --<span class="hljs-built_in">help</span><br><br>Usage: docker images [OPTIONS] [NAME] List images<br><br>  -a, --all=<span class="hljs-literal">false</span> Show all images (by default filter out the intermediate image layers) <span class="hljs-comment"># -a æ˜¾ç¤ºå½“å‰ç³»ç»Ÿçš„æ‰€æœ‰é•œåƒï¼ŒåŒ…æ‹¬è¿‡æ¸¡å±‚é•œåƒï¼Œé»˜è®¤ docker images æ˜¾ç¤ºæœ€ç»ˆé•œåƒï¼Œä¸åŒ…æ‹¬è¿‡æ¸¡å±‚é•œåƒ </span><br>  -f, --filter=[] Provide filter values (i.e. <span class="hljs-string">&#x27;dangling=true&#x27;</span>) --no-trunc=<span class="hljs-literal">false</span> Don<span class="hljs-string">&#x27;t truncate output</span><br><span class="hljs-string">  -q, --quiet=false Only show numeric IDs</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker images <span class="hljs-comment"># æ˜¾ç¤ºå½“å‰ç³»ç»Ÿé•œåƒï¼Œä¸åŒ…æ‹¬è¿‡æ¸¡å±‚é•œåƒ </span><br>$ sudo docker images -a <span class="hljs-comment"># æ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ‰€æœ‰é•œåƒï¼ŒåŒ…æ‹¬è¿‡æ¸¡å±‚é•œåƒ </span><br>$ sudo docker images ubuntu <span class="hljs-comment"># æ˜¾ç¤ºå½“å‰ç³»ç»Ÿ docker ubuntu åº“ä¸­çš„æ‰€æœ‰é•œåƒ </span><br>REPOSITORY                 TAG                 IMAGE ID            CREATED             VIRTUAL SIZE<br>ubuntu                     12.04               ebe4be4dd427 4 weeks ago         210.6 MB<br>ubuntu                     14.04               e54ca5efa2e9 4 weeks ago         276.5 MB<br>ubuntu                     14.04-ssh           6334d3ac099a 7 weeks ago         383.2 MB<br></code></pre></td></tr></table></figure>
<h2 id="4-6-docker-rmi"><a class="header-anchor" href="#4-6-docker-rmi"></a>4.6 docker rmi</h2>
<p>åˆ é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªé•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker rmi --<span class="hljs-built_in">help</span><br>Usage: docker rmi IMAGE [IMAGE...] Remove one or more images<br>  -f, --force=<span class="hljs-literal">false</span> Force removal of the image <span class="hljs-comment"># å¼ºåˆ¶ç§»é™¤é•œåƒä¸ç®¡æ˜¯å¦æœ‰å®¹å™¨ä½¿ç”¨è¯¥é•œåƒ --no-prune=false Do not delete untagged parents # ä¸è¦åˆ é™¤æœªæ ‡è®°çš„çˆ¶é•œåƒ </span><br></code></pre></td></tr></table></figure>
<h2 id="4-7-docker-run"><a class="header-anchor" href="#4-7-docker-run"></a>4.7 docker run</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run --<span class="hljs-built_in">help</span><br>Usage: docker run [OPTIONS] IMAGE [COMMAND] [ARG...]<br>Run a <span class="hljs-built_in">command</span> <span class="hljs-keyword">in</span> a new container<br>  -a, --attach=[]            Attach to stdin, stdout or stderr.<br>  -c, --cpu-shares=0         CPU shares (relative weight)                       <span class="hljs-comment"># è®¾ç½® cpu ä½¿ç”¨æƒé‡</span><br>  --cap-add=[]               Add Linux capabilities<br>  --cap-drop=[]              Drop Linux capabilities<br>  --cidfile=<span class="hljs-string">&quot;&quot;</span>               Write the container ID to the file                 <span class="hljs-comment"># æŠŠå®¹å™¨ id å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶</span><br>  --cpuset=<span class="hljs-string">&quot;&quot;</span>                CPUs <span class="hljs-keyword">in</span> <span class="hljs-built_in">which</span> to allow execution (0-3, 0,1)        <span class="hljs-comment"># cpu ç»‘å®š</span><br>  -d, --detach=<span class="hljs-literal">false</span>         Detached mode: Run container <span class="hljs-keyword">in</span> the background, <span class="hljs-built_in">print</span> new container <span class="hljs-built_in">id</span> <span class="hljs-comment"># åå°è¿è¡Œå®¹å™¨</span><br>  --device=[]                Add a host device to the container (e.g. --device=/dev/sdc:/dev/xvdc)<br>  --dns=[]                   Set custom dns servers                             <span class="hljs-comment"># è®¾ç½® dns</span><br>  --dns-search=[]            Set custom dns search domains                      <span class="hljs-comment"># è®¾ç½® dns åŸŸæœç´¢</span><br>  -e, --<span class="hljs-built_in">env</span>=[]               Set environment variables                          <span class="hljs-comment"># å®šä¹‰ç¯å¢ƒå˜é‡</span><br>  --entrypoint=<span class="hljs-string">&quot;&quot;</span>            Overwrite the default entrypoint of the image      <span class="hljs-comment"># ï¼Ÿ</span><br>  --env-file=[]              Read <span class="hljs-keyword">in</span> a line delimited file of ENV variables     <span class="hljs-comment"># ä»æŒ‡å®šæ–‡ä»¶è¯»å–å˜é‡å€¼</span><br>  --expose=[]                Expose a port from the container without publishing it to your host    <span class="hljs-comment"># æŒ‡å®šå¯¹å¤–æä¾›æœåŠ¡ç«¯å£</span><br>  -h, --hostname=<span class="hljs-string">&quot;&quot;</span>          Container host name                                <span class="hljs-comment"># è®¾ç½®å®¹å™¨ä¸»æœºå</span><br>  -i, --interactive=<span class="hljs-literal">false</span>    Keep stdin open even <span class="hljs-keyword">if</span> not attached               <span class="hljs-comment"># ä¿æŒæ ‡å‡†è¾“å‡ºå¼€å¯å³ä½¿æ²¡æœ‰ attached</span><br>  --<span class="hljs-built_in">link</span>=[]                  Add <span class="hljs-built_in">link</span> to another container (name:<span class="hljs-built_in">alias</span>)         <span class="hljs-comment"># æ·»åŠ é“¾æ¥åˆ°å¦å¤–ä¸€ä¸ªå®¹å™¨</span><br>  --lxc-conf=[]              (lxc exec-driver only) Add custom lxc options --lxc-conf=<span class="hljs-string">&quot;lxc.cgroup.cpuset.cpus = 0,1&quot;</span><br>  -m, --memory=<span class="hljs-string">&quot;&quot;</span>            Memory <span class="hljs-built_in">limit</span> (format: &lt;number&gt;&lt;optional unit&gt;, <span class="hljs-built_in">where</span> unit = b, k, m or g) <span class="hljs-comment"># å†…å­˜é™åˆ¶</span><br>  --name=<span class="hljs-string">&quot;&quot;</span>                  Assign a name to the container                     <span class="hljs-comment"># è®¾ç½®å®¹å™¨å</span><br>  --net=<span class="hljs-string">&quot;bridge&quot;</span>             Set the Network mode <span class="hljs-keyword">for</span> the container             <span class="hljs-comment"># è®¾ç½®å®¹å™¨ç½‘ç»œæ¨¡å¼</span><br>                               <span class="hljs-string">&#x27;bridge&#x27;</span>: creates a new network stack <span class="hljs-keyword">for</span> the container on the docker bridge<br>                               <span class="hljs-string">&#x27;none&#x27;</span>: no networking <span class="hljs-keyword">for</span> this container<br>                               <span class="hljs-string">&#x27;container:&lt;name|id&gt;&#x27;</span>: reuses another container network stack<br>                               <span class="hljs-string">&#x27;host&#x27;</span>: use the host network stack inside the container.  Note: the host mode gives the container full access to <span class="hljs-built_in">local</span> system services such as D-bus and is therefore considered insecure.<br>  -P, --publish-all=<span class="hljs-literal">false</span>    Publish all exposed ports to the host interfaces   <span class="hljs-comment"># è‡ªåŠ¨æ˜ å°„å®¹å™¨å¯¹å¤–æä¾›æœåŠ¡çš„ç«¯å£</span><br>  -p, --publish=[]           Publish a container<span class="hljs-string">&#x27;s port to the host             # æŒ‡å®šç«¯å£æ˜ å°„</span><br><span class="hljs-string">                               format: ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort</span><br><span class="hljs-string">                               (use &#x27;</span>docker port<span class="hljs-string">&#x27; to see the actual mapping)</span><br><span class="hljs-string">  --privileged=false         Give extended privileges to this container         # æä¾›æ›´å¤šçš„æƒé™ç»™å®¹å™¨</span><br><span class="hljs-string">  --restart=&quot;&quot;               Restart policy to apply when a container exits (no, on-failure[:max-retry], always)</span><br><span class="hljs-string">  --rm=false                 Automatically remove the container when it exits (incompatible with -d) # å¦‚æœå®¹å™¨é€€å‡ºè‡ªåŠ¨ç§»é™¤å’Œ -d é€‰é¡¹å†²çª</span><br><span class="hljs-string">  --security-opt=[]          Security Options</span><br><span class="hljs-string">  --sig-proxy=true           Proxify received signals to the process (even in non-tty mode). SIGCHLD is not proxied.</span><br><span class="hljs-string">  -t, --tty=false            Allocate a pseudo-tty                              # åˆ†é…ä¼ªç»ˆç«¯</span><br><span class="hljs-string">  -u, --user=&quot;&quot;              Username or UID                                    # æŒ‡å®šè¿è¡Œå®¹å™¨çš„ç”¨æˆ· uid æˆ–è€…ç”¨æˆ·å</span><br><span class="hljs-string">  -v, --volume=[]            Bind mount a volume (e.g., from the host: -v /host:/container, from docker: -v /container)</span><br><span class="hljs-string">                             # æŒ‚è½½å·</span><br><span class="hljs-string">  --volumes-from=[]          Mount volumes from the specified container(s)      # ä»æŒ‡å®šå®¹å™¨æŒ‚è½½å·</span><br><span class="hljs-string">  -w, --workdir=&quot;&quot;           Working directory inside the container             # æŒ‡å®šå®¹å™¨å·¥ä½œç›®å½•</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker images ubuntu<br>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE<br>ubuntu              14.04               e54ca5efa2e9 4 weeks ago         276.5 MB<br>... ... <br>$ sudo docker run -t -i -c 100 -m 512MB -h test1 -d --name=<span class="hljs-string">&quot;docker_test1&quot;</span> ubuntu /bin/bash <br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ª cpu ä¼˜å…ˆçº§ä¸º 100ï¼Œå†…å­˜é™åˆ¶ 512MBï¼Œä¸»æœºåä¸º test1ï¼Œåä¸º docker_test1 åå°è¿è¡Œ bash çš„å®¹å™¨ a424ca613c9f2247cd3ede95adfbaf8d28400cbcb1d5f9b69a7b56f97b2b52e5 </span><br>$ sudo docker ps <br>CONTAINER ID        IMAGE           COMMAND         CREATED             STATUS              PORTS       NAMES<br>a424ca613c9f        ubuntu:14.04    /bin/bash 6 seconds ago       Up 5 seconds                    docker_test1 <br>$ sudo docker attach docker_test1<br>root@test1:/<span class="hljs-comment"># pwd </span><br>/<br>root@test1:/<span class="hljs-comment"># exit </span><br><span class="hljs-built_in">exit</span> <br></code></pre></td></tr></table></figure>
<p>å…³äºcpuä¼˜å…ˆçº§:</p>
<blockquote>
<p>By default all groups have 1024 shares. A group with 100 shares will get a ~10% portion of the CPU time -<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/cgroups">archlinux cgroups</a></p>
</blockquote>
<h2 id="4-8-docker-start-stop-killâ€¦-â€¦"><a class="header-anchor" href="#4-8-docker-start-stop-killâ€¦-â€¦"></a>4.8 docker start|stop|killâ€¦ â€¦</h2>
<p>dockerstart|stop|kill|restart|pause|unpause|rm|commit|inspect|logs</p>
<ul>
<li>
<p>docker start CONTAINER [CONTAINERâ€¦]</p>
<ul>
<li># è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªåœæ­¢çš„å®¹å™¨</li>
</ul>
</li>
<li>
<p>docker stop CONTAINER [CONTAINERâ€¦]</p>
<ul>
<li># åœæ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¿è¡Œçš„å®¹å™¨-té€‰é¡¹å¯æŒ‡å®šè¶…æ—¶æ—¶é—´</li>
</ul>
</li>
<li>
<p>docker kill [OPTIONS] CONTAINER [CONTAINERâ€¦]</p>
<ul>
<li># é»˜è®¤ kill å‘é€ SIGKILL ä¿¡å·-så¯ä»¥æŒ‡å®šå‘é€ kill ä¿¡å·ç±»å‹</li>
</ul>
</li>
<li>
<p>docker restart [OPTIONS] CONTAINER [CONTAINERâ€¦]</p>
<ul>
<li># é‡å¯ä¸€ä¸ªæˆ–å¤šä¸ªè¿è¡Œçš„å®¹å™¨-té€‰é¡¹å¯æŒ‡å®šè¶…æ—¶æ—¶é—´</li>
</ul>
</li>
<li>
<p>docker pause CONTAINER</p>
<ul>
<li># æš‚åœä¸€ä¸ªå®¹å™¨ï¼Œæ–¹ä¾¿ commit</li>
</ul>
</li>
<li>
<p>docker unpause CONTAINER</p>
<ul>
<li># ç»§ç»­æš‚åœçš„å®¹å™¨</li>
</ul>
</li>
<li>
<p>docker rm [OPTIONS] CONTAINER [CONTAINERâ€¦]</p>
<ul>
<li># ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨</li>
<li>-f, --force=false Force removal of running container</li>
<li>-l, --link=false Remove the specified link and not the underlying container</li>
<li>-v, --volumes=false Remove the volumes associated with the container</li>
</ul>
</li>
<li>
<p>docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</p>
<ul>
<li># æäº¤æŒ‡å®šå®¹å™¨ä¸ºé•œåƒ</li>
<li>-a, --author=â€œâ€ Author (e.g., â€œJohn Hannibal SmithÂ <a href="mailto:hannibal@a-team.com">hannibal@a-team.com</a>â€)</li>
<li>-m, --message=â€œâ€ Commit message</li>
<li>-p, --pause=true Pause container during commit
<ul>
<li># é»˜è®¤ commit æ˜¯æš‚åœçŠ¶æ€</li>
</ul>
</li>
</ul>
</li>
<li>
<p>docker inspect CONTAINER|IMAGE [CONTAINER|IMAGEâ€¦]</p>
<ul>
<li># æŸ¥çœ‹å®¹å™¨æˆ–è€…é•œåƒçš„è¯¦ç»†ä¿¡æ¯</li>
</ul>
</li>
<li>
<p>docker logs CONTAINER</p>
<ul>
<li># è¾“å‡ºæŒ‡å®šå®¹å™¨æ—¥å¿—ä¿¡æ¯</li>
<li>-f, --follow=false Follow log output
<ul>
<li># ç±»ä¼¼ tail -f</li>
</ul>
</li>
<li>-t, --timestamps=false Show timestamps</li>
<li>â€“tail=â€œallâ€ Output the specified number of lines at the end of logs (defaults to all logs)</li>
</ul>
</li>
</ul>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/run/">Docker Run Reference</a></p>
<h2 id="4-9-Docker-1-3-æ–°å¢ç‰¹æ€§å’Œå‘½ä»¤"><a class="header-anchor" href="#4-9-Docker-1-3-æ–°å¢ç‰¹æ€§å’Œå‘½ä»¤"></a>4.9 Docker 1.3 æ–°å¢ç‰¹æ€§å’Œå‘½ä»¤</h2>
<h3 id="Digital-Signature-Verification"><a class="header-anchor" href="#Digital-Signature-Verification"></a>Digital Signature Verification</h3>
<p>Docker 1.3 ç‰ˆæœ¬å°†ä½¿ç”¨æ•°å­—ç­¾åè‡ªåŠ¨éªŒè¯æ‰€æœ‰å®˜æ–¹åº“çš„æ¥æºå’Œå®Œæ•´æ€§ï¼Œå¦‚æœä¸€ä¸ªå®˜æ–¹é•œåƒè¢«ç¯¡æ”¹æˆ–è€…è¢«ç ´åï¼Œç›®å‰ Docker åªä¼šå¯¹è¿™ç§æƒ…å†µå‘å‡ºè­¦å‘Šè€Œå¹¶ä¸é˜»æ­¢å®¹å™¨çš„è¿è¡Œã€‚</p>
<h3 id="Inject-new-processes-withdocker-exec"><a class="header-anchor" href="#Inject-new-processes-withdocker-exec"></a>Inject new processes withdocker exec</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> --<span class="hljs-built_in">help</span><br>Usage: docker <span class="hljs-built_in">exec</span> [OPTIONS] CONTAINER COMMAND [ARG...] Run a <span class="hljs-built_in">command</span> <span class="hljs-keyword">in</span> an existing container<br>  -d, --detach=<span class="hljs-literal">false</span> Detached mode: run <span class="hljs-built_in">command</span> <span class="hljs-keyword">in</span> the background<br>  -i, --interactive=<span class="hljs-literal">false</span> Keep STDIN open even <span class="hljs-keyword">if</span> not attached<br>  -t, --<span class="hljs-built_in">tty</span>=<span class="hljs-literal">false</span> Allocate a pseudo-TTY<br></code></pre></td></tr></table></figure>
<p>ä¸ºäº†ç®€åŒ–è°ƒè¯•ï¼Œå¯ä»¥ä½¿ç”¨docker execå‘½ä»¤é€šè¿‡ Docker API å’Œ CLI åœ¨è¿è¡Œçš„å®¹å™¨ä¸Šè¿è¡Œç¨‹åºã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker <span class="hljs-built_in">exec</span> -it ubuntu_bash bash<br></code></pre></td></tr></table></figure>
<p>ä¸Šä¾‹å°†åœ¨å®¹å™¨ ubuntu_bash ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ Bash ä¼šè¯ã€‚</p>
<h3 id="Tune-container-lifecycles-withdocker-create"><a class="header-anchor" href="#Tune-container-lifecycles-withdocker-create"></a>Tune container lifecycles withdocker create</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡docker run <image name>å‘½ä»¤åˆ›å»ºä¸€ä¸ªå®¹å™¨å¹¶è¿è¡Œå…¶ä¸­çš„ç¨‹åºï¼Œå› ä¸ºæœ‰å¾ˆå¤šç”¨æˆ·è¦æ±‚åˆ›å»ºå®¹å™¨çš„æ—¶å€™ä¸å¯åŠ¨å®¹å™¨ï¼Œæ‰€ä»¥docker createåº”è¿è€Œç”Ÿäº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker create -t -i fedora bash<br>6d8af538ec541dd581ebc2a24153a28329acb5268abe5ef868c1f1a261221752<br></code></pre></td></tr></table></figure>
<p>ä¸Šä¾‹åˆ›å»ºäº†ä¸€ä¸ªå¯å†™çš„å®¹å™¨å±‚ (å¹¶ä¸”æ‰“å°å‡ºå®¹å™¨ ID)ï¼Œä½†æ˜¯å¹¶ä¸è¿è¡Œå®ƒï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œè¯¥å®¹å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker start -a -i 6d8af538ec5<br>bash-4.2<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>
<h3 id="Security-Options"><a class="header-anchor" href="#Security-Options"></a>Security Options</h3>
<p>é€šè¿‡â€“security-opté€‰é¡¹ï¼Œè¿è¡Œå®¹å™¨æ—¶ç”¨æˆ·å¯è‡ªå®šä¹‰ SELinux å’Œ AppArmor å·æ ‡å’Œé…ç½®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker run --security-opt label:<span class="hljs-built_in">type</span>:svirt_apache -i -t centos \ bash<br></code></pre></td></tr></table></figure>
<p>ä¸Šä¾‹åªå…è®¸å®¹å™¨ç›‘å¬åœ¨ Apache ç«¯å£ï¼Œè¿™ä¸ªé€‰é¡¹çš„å¥½å¤„æ˜¯ç”¨æˆ·ä¸éœ€è¦è¿è¡Œ docker çš„æ—¶å€™æŒ‡å®šâ€“privilegedé€‰é¡¹ï¼Œé™ä½å®‰å…¨é£é™©ã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="http://blog.docker.com/2014/10/docker-1-3-signed-images-process-injection-security-options-mac-shared-directories/">Docker 1.3: signed images, process injection, security options, Mac shared directories</a></p>
<h2 id="4-10-Docker-1-5-æ–°ç‰¹æ€§"><a class="header-anchor" href="#4-10-Docker-1-5-æ–°ç‰¹æ€§"></a>4.10 Docker 1.5 æ–°ç‰¹æ€§</h2>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="http://dockerone.com/article/202">Docker 1.5 æ–°ç‰¹æ€§</a></p>
<h1 id="äº”ã€Docker-ç«¯å£æ˜ å°„"><a class="header-anchor" href="#äº”ã€Docker-ç«¯å£æ˜ å°„"></a>äº”ã€Docker ç«¯å£æ˜ å°„</h1>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Find IP address of container with ID &lt;container_id&gt; é€šè¿‡å®¹å™¨ id è·å– ip </span><br>$ sudo docker inspect &lt;container_id&gt; | grep IPAddress | <span class="hljs-built_in">cut</span> -d â€™<span class="hljs-string">&quot;â€™ -f 4</span><br></code></pre></td></tr></table></figure>
<p>æ— è®ºå¦‚ä½•ï¼Œè¿™äº› ip æ˜¯åŸºäºæœ¬åœ°ç³»ç»Ÿçš„å¹¶ä¸”å®¹å™¨çš„ç«¯å£éæœ¬åœ°ä¸»æœºæ˜¯è®¿é—®ä¸åˆ°çš„ã€‚æ­¤å¤–ï¼Œé™¤äº†ç«¯å£åªèƒ½æœ¬åœ°è®¿é—®å¤–ï¼Œå¯¹äºå®¹å™¨çš„å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯è¿™äº› ip åœ¨å®¹å™¨æ¯æ¬¡å¯åŠ¨çš„æ—¶å€™éƒ½ä¼šæ”¹å˜ã€‚</p>
<p>Docker è§£å†³äº†å®¹å™¨çš„è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”ç»™å®¹å™¨å†…éƒ¨æœåŠ¡çš„è®¿é—®æä¾›äº†ä¸€ä¸ªç®€å•è€Œå¯é çš„æ–¹æ³•ã€‚Docker é€šè¿‡ç«¯å£ç»‘å®šä¸»æœºç³»ç»Ÿçš„æ¥å£ï¼Œå…è®¸éæœ¬åœ°å®¢æˆ·ç«¯è®¿é—®å®¹å™¨å†…éƒ¨è¿è¡Œçš„æœåŠ¡ã€‚ä¸ºäº†ç®€ä¾¿çš„ä½¿å¾—å®¹å™¨é—´é€šä¿¡ï¼ŒDocker æä¾›äº†è¿™ç§è¿æ¥æœºåˆ¶ã€‚</p>
<h2 id="5-1-è‡ªåŠ¨æ˜ å°„ç«¯å£"><a class="header-anchor" href="#5-1-è‡ªåŠ¨æ˜ å°„ç«¯å£"></a>5.1 è‡ªåŠ¨æ˜ å°„ç«¯å£</h2>
<p>-Pä½¿ç”¨æ—¶éœ€è¦æŒ‡å®šâ€“exposeé€‰é¡¹ï¼ŒæŒ‡å®šéœ€è¦å¯¹å¤–æä¾›æœåŠ¡çš„ç«¯å£</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -t -P --expose 22 --name server  ubuntu:14.04<br></code></pre></td></tr></table></figure>
<p>ä½¿ç”¨docker run -Pè‡ªåŠ¨ç»‘å®šæ‰€æœ‰å¯¹å¤–æä¾›æœåŠ¡çš„å®¹å™¨ç«¯å£ï¼Œæ˜ å°„çš„ç«¯å£å°†ä¼šä»æ²¡æœ‰ä½¿ç”¨çš„ç«¯å£æ± ä¸­ (49000â€¦49900) è‡ªåŠ¨é€‰æ‹©ï¼Œä½ å¯ä»¥é€šè¿‡docker psã€docker inspect &lt;container_id&gt;æˆ–è€…docker port &lt;container_id&gt; <port>ç¡®å®šå…·ä½“çš„ç»‘å®šä¿¡æ¯ã€‚</p>
<h2 id="5-2-ç»‘å®šç«¯å£åˆ°æŒ‡å®šæ¥å£"><a class="header-anchor" href="#5-2-ç»‘å®šç«¯å£åˆ°æŒ‡å®šæ¥å£"></a>5.2 ç»‘å®šç«¯å£åˆ°æŒ‡å®šæ¥å£</h2>
<p>åŸºæœ¬è¯­æ³•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -p [([&lt;host_interface&gt;:[host_port]])|(&lt;host_port&gt;):]&lt;container_port&gt;[/udp] &lt;image&gt; &lt;cmd&gt;<br></code></pre></td></tr></table></figure>
<p>é»˜è®¤ä¸æŒ‡å®šç»‘å®š ip åˆ™ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ã€‚</p>
<h3 id="ç»‘å®š-TCP-ç«¯å£"><a class="header-anchor" href="#ç»‘å®š-TCP-ç«¯å£"></a>ç»‘å®š TCP ç«¯å£</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Bind TCP port 8080 of the container to TCP port 80 on 127.0.0.1 of the host machine. </span><br>$ sudo docker run -p 127.0.0.1:80:8080 &lt;image&gt; &lt;cmd&gt; <span class="hljs-comment"># Bind TCP port 8080 of the container to a dynamically allocated TCP port on 127.0.0.1 of the host machine. </span><br>$ sudo docker run -p 127.0.0.1::8080 &lt;image&gt; &lt;cmd&gt; <span class="hljs-comment"># Bind TCP port 8080 of the container to TCP port 80 on all available interfaces of the host machine. </span><br>$ sudo docker run -p 80:8080 &lt;image&gt; &lt;cmd&gt; <span class="hljs-comment"># Bind TCP port 8080 of the container to a dynamically allocated TCP port on all available interfaces </span><br>$ sudo docker run -p 8080 &lt;image&gt; &lt;cmd&gt;<br></code></pre></td></tr></table></figure>
<h3 id="ç»‘å®š-UDP-ç«¯å£"><a class="header-anchor" href="#ç»‘å®š-UDP-ç«¯å£"></a>ç»‘å®š UDP ç«¯å£</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Bind UDP port 5353 of the container to UDP port 53 on 127.0.0.1 of the host machine. </span><br>$ sudo docker run -p 127.0.0.1:53:5353/udp &lt;image&gt; &lt;cmd&gt;<br></code></pre></td></tr></table></figure>
<h1 id="å…­ã€Docker-ç½‘ç»œé…ç½®"><a class="header-anchor" href="#å…­ã€Docker-ç½‘ç»œé…ç½®"></a>å…­ã€Docker ç½‘ç»œé…ç½®</h1>
<p><img src="http://static.open-open.com/lib/uploadImg/20150212/20150212091034_634.png" srcset="/img/loading.gif" lazyload alt="éå¸¸è¯¦ç»†çš„ Docker å­¦ä¹ ç¬”è®°"></p>
<p>å›¾:Â <a target="_blank" rel="noopener" href="http://www.slideshare.net/janghoonsim/docker-container-and-lightweight-virtualization">Docker - container and lightweight virtualization</a></p>
<p>Dokcer é€šè¿‡ä½¿ç”¨ Linux æ¡¥æ¥æä¾›å®¹å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œdocker0 æ¡¥æ¥æ¥å£çš„ç›®çš„å°±æ˜¯æ–¹ä¾¿ Docker ç®¡ç†ã€‚å½“ Docker daemon å¯åŠ¨æ—¶éœ€è¦åšä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>creates the docker0 bridge if not present
<ul>
<li># å¦‚æœ docker0 ä¸å­˜åœ¨åˆ™åˆ›å»º</li>
</ul>
</li>
<li>searches for an IP address range which doesnâ€™t overlap with an existing route
<ul>
<li># æœç´¢ä¸€ä¸ªä¸å½“å‰è·¯ç”±ä¸å†²çªçš„ ip æ®µ</li>
</ul>
</li>
<li>picks an IP in the selected range
<ul>
<li># åœ¨ç¡®å®šçš„èŒƒå›´ä¸­é€‰æ‹© ip</li>
</ul>
</li>
<li>assigns this IP to the docker0 bridge
<ul>
<li># ç»‘å®š ip åˆ° docker0</li>
</ul>
</li>
</ul>
<h2 id="6-1-Docker-å››ç§ç½‘ç»œæ¨¡å¼"><a class="header-anchor" href="#6-1-Docker-å››ç§ç½‘ç»œæ¨¡å¼"></a>6.1 Docker å››ç§ç½‘ç»œæ¨¡å¼</h2>
<p>å››ç§ç½‘ç»œæ¨¡å¼æ‘˜è‡ªÂ <a target="_blank" rel="noopener" href="http://www.infoq.com/cn/articles/docker-network-and-pipework-open-source-explanation-practice">Docker ç½‘ç»œè¯¦è§£åŠ pipework æºç è§£è¯»ä¸å®è·µ</a></p>
<p>docker run åˆ›å»º Docker å®¹å™¨æ—¶ï¼Œå¯ä»¥ç”¨ --net é€‰é¡¹æŒ‡å®šå®¹å™¨çš„ç½‘ç»œæ¨¡å¼ï¼ŒDocker æœ‰ä»¥ä¸‹ 4 ç§ç½‘ç»œæ¨¡å¼ï¼š</p>
<ul>
<li>host æ¨¡å¼ï¼Œä½¿ç”¨ --net=host æŒ‡å®šã€‚</li>
<li>container æ¨¡å¼ï¼Œä½¿ç”¨ --net=container:NAMEorID æŒ‡å®šã€‚</li>
<li>none æ¨¡å¼ï¼Œä½¿ç”¨ --net=none æŒ‡å®šã€‚</li>
<li>bridge æ¨¡å¼ï¼Œä½¿ç”¨ --net=bridge æŒ‡å®šï¼Œé»˜è®¤è®¾ç½®ã€‚</li>
</ul>
<h3 id="host-æ¨¡å¼"><a class="header-anchor" href="#host-æ¨¡å¼"></a>host æ¨¡å¼</h3>
<p>å¦‚æœå¯åŠ¨å®¹å™¨çš„æ—¶å€™ä½¿ç”¨ host æ¨¡å¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨å°†ä¸ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„ Network Namespaceï¼Œè€Œæ˜¯å’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ª Network Namespaceã€‚å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„ IP ç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ 10.10.101.105/24 çš„æœºå™¨ä¸Šç”¨ host æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå«æœ‰ web åº”ç”¨çš„ Docker å®¹å™¨ï¼Œç›‘å¬ tcp 80 ç«¯å£ã€‚å½“æˆ‘ä»¬åœ¨å®¹å™¨ä¸­æ‰§è¡Œä»»ä½•ç±»ä¼¼ ifconfig å‘½ä»¤æŸ¥çœ‹ç½‘ç»œç¯å¢ƒæ—¶ï¼Œçœ‹åˆ°çš„éƒ½æ˜¯å®¿ä¸»æœºä¸Šçš„ä¿¡æ¯ã€‚è€Œå¤–ç•Œè®¿é—®å®¹å™¨ä¸­çš„åº”ç”¨ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ 10.10.101.105:80 å³å¯ï¼Œä¸ç”¨ä»»ä½• NAT è½¬æ¢ï¼Œå°±å¦‚ç›´æ¥è·‘åœ¨å®¿ä¸»æœºä¸­ä¸€æ ·ã€‚ä½†æ˜¯ï¼Œå®¹å™¨çš„å…¶ä»–æ–¹é¢ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯å’Œå®¿ä¸»æœºéš”ç¦»çš„ã€‚</p>
<h3 id="container-æ¨¡å¼"><a class="header-anchor" href="#container-æ¨¡å¼"></a>container æ¨¡å¼</h3>
<p>è¿™ä¸ªæ¨¡å¼æŒ‡å®šæ–°åˆ›å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ª Network Namespaceï¼Œè€Œä¸æ˜¯å’Œå®¿ä¸»æœºå…±äº«ã€‚æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„ IPï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº« IPã€ç«¯å£èŒƒå›´ç­‰ã€‚åŒæ ·ï¼Œä¸¤ä¸ªå®¹å™¨é™¤äº†ç½‘ç»œæ–¹é¢ï¼Œå…¶ä»–çš„å¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯éš”ç¦»çš„ã€‚ä¸¤ä¸ªå®¹å™¨çš„è¿›ç¨‹å¯ä»¥é€šè¿‡ lo ç½‘å¡è®¾å¤‡é€šä¿¡ã€‚</p>
<h3 id="noneæ¨¡å¼"><a class="header-anchor" href="#noneæ¨¡å¼"></a>noneæ¨¡å¼</h3>
<p>è¿™ä¸ªæ¨¡å¼å’Œå‰ä¸¤ä¸ªä¸åŒã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒDocker å®¹å™¨æ‹¥æœ‰è‡ªå·±çš„ Network Namespaceï¼Œä½†æ˜¯ï¼Œå¹¶ä¸ä¸º Dockerå®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ª Docker å®¹å™¨æ²¡æœ‰ç½‘å¡ã€IPã€è·¯ç”±ç­‰ä¿¡æ¯ã€‚éœ€è¦æˆ‘ä»¬è‡ªå·±ä¸º Docker å®¹å™¨æ·»åŠ ç½‘å¡ã€é…ç½® IP ç­‰ã€‚</p>
<h3 id="bridgeæ¨¡å¼"><a class="header-anchor" href="#bridgeæ¨¡å¼"></a>bridgeæ¨¡å¼</h3>
<p><img src="http://static.open-open.com/lib/uploadImg/20150212/20150212091035_252.png" srcset="/img/loading.gif" lazyload alt="éå¸¸è¯¦ç»†çš„ Docker å­¦ä¹ ç¬”è®°"></p>
<p>å›¾:<a target="_blank" rel="noopener" href="http://www.wickedawesometech.us/2014/07/the-container-world-part-2-networking.html">The Container World | Part 2 Networking</a></p>
<p>bridge æ¨¡å¼æ˜¯ Docker é»˜è®¤çš„ç½‘ç»œè®¾ç½®ï¼Œæ­¤æ¨¡å¼ä¼šä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é… Network Namespaceã€è®¾ç½® IP ç­‰ï¼Œå¹¶å°†ä¸€ä¸ªä¸»æœºä¸Šçš„ Docker å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚å½“ Docker server å¯åŠ¨æ—¶ï¼Œä¼šåœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º docker0 çš„è™šæ‹Ÿç½‘æ¡¥ï¼Œæ­¤ä¸»æœºä¸Šå¯åŠ¨çš„ Docker å®¹å™¨ä¼šè¿æ¥åˆ°è¿™ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚è™šæ‹Ÿç½‘æ¡¥çš„å·¥ä½œæ–¹å¼å’Œç‰©ç†äº¤æ¢æœºç±»ä¼¼ï¼Œè¿™æ ·ä¸»æœºä¸Šçš„æ‰€æœ‰å®¹å™¨å°±é€šè¿‡äº¤æ¢æœºè¿åœ¨äº†ä¸€ä¸ªäºŒå±‚ç½‘ç»œä¸­ã€‚æ¥ä¸‹æ¥å°±è¦ä¸ºå®¹å™¨åˆ†é… IP äº†ï¼ŒDocker ä¼šä» RFC1918 æ‰€å®šä¹‰çš„ç§æœ‰ IP ç½‘æ®µä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªå’Œå®¿ä¸»æœºä¸åŒçš„IPåœ°å€å’Œå­ç½‘åˆ†é…ç»™ docker0ï¼Œè¿æ¥åˆ° docker0 çš„å®¹å™¨å°±ä»è¿™ä¸ªå­ç½‘ä¸­é€‰æ‹©ä¸€ä¸ªæœªå ç”¨çš„ IP ä½¿ç”¨ã€‚å¦‚ä¸€èˆ¬ Docker ä¼šä½¿ç”¨ 172.17.0.0/16 è¿™ä¸ªç½‘æ®µï¼Œå¹¶å°† 172.17.42.1/16 åˆ†é…ç»™ docker0 ç½‘æ¡¥ï¼ˆåœ¨ä¸»æœºä¸Šä½¿ç”¨ ifconfig å‘½ä»¤æ˜¯å¯ä»¥çœ‹åˆ° docker0 çš„ï¼Œå¯ä»¥è®¤ä¸ºå®ƒæ˜¯ç½‘æ¡¥çš„ç®¡ç†æ¥å£ï¼Œåœ¨å®¿ä¸»æœºä¸Šä½œä¸ºä¸€å—è™šæ‹Ÿç½‘å¡ä½¿ç”¨ï¼‰</p>
<h2 id="6-2-åˆ—å‡ºå½“å‰ä¸»æœºç½‘æ¡¥"><a class="header-anchor" href="#6-2-åˆ—å‡ºå½“å‰ä¸»æœºç½‘æ¡¥"></a>6.2 åˆ—å‡ºå½“å‰ä¸»æœºç½‘æ¡¥</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo brctl show <span class="hljs-comment"># brctl å·¥å…·ä¾èµ– bridge-utils è½¯ä»¶åŒ… bridge name bridge id STP enabled interfaces</span><br>docker0 8000.000000000000 no<br></code></pre></td></tr></table></figure>
<h2 id="6-3-æŸ¥çœ‹å½“å‰-docker0-ip"><a class="header-anchor" href="#6-3-æŸ¥çœ‹å½“å‰-docker0-ip"></a>6.3 æŸ¥çœ‹å½“å‰ docker0 ip</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo ifconfig docker0<br>docker0 Link encap:Ethernet HWaddr xx:xx:xx:xx:xx:xx<br>inet addr:172.17.42.1 Bcast:0.0.0.0 Mask:255.255.0.0<br></code></pre></td></tr></table></figure>
<p>åœ¨å®¹å™¨è¿è¡Œæ—¶ï¼Œæ¯ä¸ªå®¹å™¨éƒ½ä¼šåˆ†é…ä¸€ä¸ªç‰¹å®šçš„è™šæ‹Ÿæœºå£å¹¶æ¡¥æ¥åˆ° docker0ã€‚æ¯ä¸ªå®¹å™¨éƒ½ä¼šé…ç½®åŒ docker0 ip ç›¸åŒç½‘æ®µçš„ä¸“ç”¨ ip åœ°å€ï¼Œdocker0 çš„ IP åœ°å€è¢«ç”¨äºæ‰€æœ‰å®¹å™¨çš„é»˜è®¤ç½‘å…³ã€‚</p>
<h2 id="6-4-è¿è¡Œä¸€ä¸ªå®¹å™¨"><a class="header-anchor" href="#6-4-è¿è¡Œä¸€ä¸ªå®¹å™¨"></a>6.4 è¿è¡Œä¸€ä¸ªå®¹å™¨</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -t -i -d ubuntu /bin/bash<br>52f811c5d3d69edddefc75aff5a4525fc8ba8bcfa1818132f9dc7d4f7c7e78b4 <br>$ sudo brctl show<br>bridge name bridge <span class="hljs-built_in">id</span> STP enabled interfaces<br>docker0 8000.fef213db5a66 no vethQCDY1N<br></code></pre></td></tr></table></figure>
<p>ä»¥ä¸Š, docker0 æ‰®æ¼”ç€ 52f811c5d3d6 container è¿™ä¸ªå®¹å™¨çš„è™šæ‹Ÿæ¥å£ vethQCDY1N interface æ¡¥æ¥çš„è§’è‰²ã€‚</p>
<h3 id="ä½¿ç”¨ç‰¹å®šèŒƒå›´çš„-IP"><a class="header-anchor" href="#ä½¿ç”¨ç‰¹å®šèŒƒå›´çš„-IP"></a>ä½¿ç”¨ç‰¹å®šèŒƒå›´çš„ IP</h3>
<p>Docker ä¼šå°è¯•å¯»æ‰¾æ²¡æœ‰è¢«ä¸»æœºä½¿ç”¨çš„ ip æ®µï¼Œå°½ç®¡å®ƒé€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½†æ˜¯å®ƒä¸æ˜¯ä¸‡èƒ½çš„ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è¿˜æ˜¯éœ€è¦å¯¹ ip è¿›ä¸€æ­¥è§„åˆ’ã€‚Docker å…è®¸ä½ ç®¡ç† docker0 æ¡¥æ¥æˆ–è€…é€šè¿‡-bé€‰é¡¹è‡ªå®šä¹‰æ¡¥æ¥ç½‘å¡ï¼Œéœ€è¦å®‰è£…bridge-utilsè½¯ä»¶åŒ…ã€‚</p>
<p>åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>ensure Docker is stopped</p>
<ul>
<li># ç¡®ä¿ docker çš„è¿›ç¨‹æ˜¯åœæ­¢çš„</li>
</ul>
</li>
<li>
<p>create your own bridge (bridge0 for example)</p>
<ul>
<li># åˆ›å»ºè‡ªå®šä¹‰ç½‘æ¡¥</li>
</ul>
</li>
<li>
<p>assign a specific IP to this bridge</p>
<ul>
<li># ç»™ç½‘æ¡¥åˆ†é…ç‰¹å®šçš„ ip</li>
</ul>
</li>
<li>
<p>start Docker with the -b=bridge0 parameter</p>
<ul>
<li># ä»¥ -b çš„æ–¹å¼æŒ‡å®šç½‘æ¡¥</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Stopping Docker and removing docker0 </span><br>$ sudo service docker stop <br>$ sudo ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> dev docker0 down <br>$ sudo brctl delbr docker0 <span class="hljs-comment"># Create our own bridge </span><br>$ sudo brctl addbr bridge0 <br>$ sudo ip addr add 192.168.5.1/24 dev bridge0 <br>$ sudo ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> dev bridge0 up <span class="hljs-comment"># Confirming that our bridge is up and running </span><br>$ ip addr show bridge0<br>4: bridge0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state UP group default<br>    <span class="hljs-built_in">link</span>/ether 66:38:d0:0d:76:18 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.5.1/24 scope global bridge0<br>       valid_lft forever preferred_lft forever <span class="hljs-comment"># Tell Docker about it and restart (on Ubuntu) </span><br>$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;DOCKER_OPTS=&quot;-b=bridge0&quot;&#x27;</span> &gt;&gt; /etc/default/docker <br>$ sudo service docker start<br></code></pre></td></tr></table></figure>
<p>å‚è€ƒæ–‡æ¡£:Â <a target="_blank" rel="noopener" href="https://docs.docker.com/articles/networking/">Network Configuration</a></p>
<h2 id="6-5-ä¸åŒä¸»æœºé—´å®¹å™¨é€šä¿¡"><a class="header-anchor" href="#6-5-ä¸åŒä¸»æœºé—´å®¹å™¨é€šä¿¡"></a>6.5 ä¸åŒä¸»æœºé—´å®¹å™¨é€šä¿¡</h2>
<p>ä¸åŒå®¹å™¨ä¹‹é—´çš„é€šä¿¡å¯ä»¥å€ŸåŠ©äº pipework è¿™ä¸ªå·¥å…·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git <span class="hljs-built_in">clone</span> https://github.com/jpetazzo/pipework.git<br>$ sudo <span class="hljs-built_in">cp</span> -rp pipework/pipework /usr/local/bin/<br></code></pre></td></tr></table></figure>
<h3 id="å®‰è£…ç›¸åº”ä¾èµ–è½¯ä»¶"><a class="header-anchor" href="#å®‰è£…ç›¸åº”ä¾èµ–è½¯ä»¶"></a>å®‰è£…ç›¸åº”ä¾èµ–è½¯ä»¶</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt-get install iputils-arping bridge-utils -y<br></code></pre></td></tr></table></figure>
<h3 id="æ¡¥æ¥ç½‘ç»œ"><a class="header-anchor" href="#æ¡¥æ¥ç½‘ç»œ"></a>æ¡¥æ¥ç½‘ç»œ</h3>
<p>æ¡¥æ¥ç½‘ç»œå¯ä»¥å‚è€ƒÂ <a target="_blank" rel="noopener" href="https://github.com/opskumu/Day/blob/master/tips/tips.md">æ—¥å¸¸é—®é¢˜å¤„ç† Tips</a>Â å…³äºæ¡¥æ¥çš„é…ç½®è¯´æ˜ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># brctl show</span><br>bridge name     bridge <span class="hljs-built_in">id</span>               STP enabled     interfaces<br>br0             8000.000c291412cd       no              eth0<br>docker0         8000.56847afe9799       no              vetheb48029<br></code></pre></td></tr></table></figure>
<p>å¯ä»¥åˆ é™¤ docker0ï¼Œç›´æ¥æŠŠ docker çš„æ¡¥æ¥æŒ‡å®šä¸º br0ã€‚ä¹Ÿå¯ä»¥ä¿ç•™ä½¿ç”¨é»˜è®¤çš„é…ç½®ï¼Œè¿™æ ·å•ä¸»æœºå®¹å™¨ä¹‹é—´çš„é€šä¿¡å¯ä»¥é€šè¿‡ docker0ï¼Œè€Œè·¨ä¸»æœºä¸åŒå®¹å™¨ä¹‹é—´é€šè¿‡ pipework æ–°å»º docker å®¹å™¨çš„ç½‘å¡æ¡¥æ¥åˆ° br0ï¼Œè¿™æ ·è·¨ä¸»æœºå®¹å™¨ä¹‹é—´å°±å¯ä»¥é€šä¿¡äº†ã€‚</p>
<ul>
<li>ubuntu</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo service docker stop<br>$ sudo ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> dev docker0 down<br>$ sudo brctl delbr docker0<br>$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;DOCKER_OPTS=&quot;-b=br0&quot;&#x27;</span> &gt;&gt; /etc/default/docker<br>$ sudo service docker start<br></code></pre></td></tr></table></figure>
<ul>
<li>CentOS 7/RHEL 7</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo systemctl stop docker<br>$ sudo ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> dev docker0 down<br>$ sudo brctl delbr docker0<br>$ <span class="hljs-built_in">cat</span> /etc/sysconfig/docker | grep <span class="hljs-string">&#x27;OPTIONS=&#x27;</span><br>OPTIONS=--selinux-enabled -b=br0 -H fd://<br>$ sudo systemctl start docker<br></code></pre></td></tr></table></figure>
<h3 id="pipework"><a class="header-anchor" href="#pipework"></a>pipework</h3>
<p><img src="http://static.open-open.com/lib/uploadImg/20150212/20150212091035_900.png" srcset="/img/loading.gif" lazyload alt="éå¸¸è¯¦ç»†çš„ Docker å­¦ä¹ ç¬”è®°"></p>
<p>ä¸åŒå®¹å™¨ä¹‹é—´çš„é€šä¿¡å¯ä»¥å€ŸåŠ©äº pipework è¿™ä¸ªå·¥å…·ç»™ docker å®¹å™¨æ–°å»ºè™šæ‹Ÿç½‘å¡å¹¶ç»‘å®š IP æ¡¥æ¥åˆ° br0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git <span class="hljs-built_in">clone</span> https://github.com/jpetazzo/pipework.git<br>$ sudo <span class="hljs-built_in">cp</span> -rp pipework/pipework /usr/local/bin/<br>$ pipework <br>Syntax:<br>pipework &lt;hostinterface&gt; [-i containerinterface] &lt;guest&gt; &lt;ipaddr&gt;/&lt;subnet&gt;[@default_gateway] [macaddr][@vlan]<br>pipework &lt;hostinterface&gt; [-i containerinterface] &lt;guest&gt; dhcp [macaddr][@vlan]<br>pipework --<span class="hljs-built_in">wait</span> [-i containerinterface]<br></code></pre></td></tr></table></figure>
<p>å¦‚æœåˆ é™¤äº†é»˜è®¤çš„ docker0 æ¡¥æ¥ï¼ŒæŠŠ docker é»˜è®¤æ¡¥æ¥æŒ‡å®šåˆ°äº† br0ï¼Œåˆ™æœ€å¥½åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™åŠ ä¸Šâ€“net=noneï¼Œé˜²æ­¢è‡ªåŠ¨åˆ†é…çš„ IP åœ¨å±€åŸŸç½‘ä¸­æœ‰å†²çªã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run --<span class="hljs-built_in">rm</span> -ti --net=none ubuntu:14.04 /bin/bash<br>root@a46657528059:/<span class="hljs-comment">#</span><br>$                  <span class="hljs-comment"># Ctrl-P + Ctrl-Q å›åˆ°å®¿ä¸»æœº shellï¼Œå®¹å™¨ detach çŠ¶æ€</span><br>$ sudo docker  ps<br>CONTAINER ID    IMAGE          COMMAND       CREATED         STATUS          PORTS      NAMES<br>a46657528059    ubuntu:14.04   <span class="hljs-string">&quot;/bin/bash&quot;</span>   4 minutes ago   Up 4 minutes               hungry_lalande<br>$ sudo pipework br0 -i eth0 a46657528059 192.168.115.10/24@192.168.115.2 <br><span class="hljs-comment"># é»˜è®¤ä¸æŒ‡å®šç½‘å¡è®¾å¤‡åï¼Œåˆ™é»˜è®¤æ·»åŠ ä¸º eth1</span><br><span class="hljs-comment"># å¦å¤– pipework ä¸èƒ½æ·»åŠ é™æ€è·¯ç”±ï¼Œå¦‚æœæœ‰éœ€æ±‚åˆ™å¯ä»¥åœ¨ run çš„æ—¶å€™åŠ ä¸Š --privileged=true æƒé™åœ¨å®¹å™¨ä¸­æ‰‹åŠ¨æ·»åŠ ï¼Œ</span><br><span class="hljs-comment"># ä½†è¿™ç§å®‰å…¨æ€§æœ‰ç¼ºé™·ï¼Œå¯ä»¥é€šè¿‡ ip netns æ“ä½œ</span><br>$ sudo docker attach a46657528059<br>root@a46657528059:/<span class="hljs-comment"># ifconfig eth0</span><br>eth0      Link encap:Ethernet  HWaddr 86:b6:6b:e8:2e:4d  <br>          inet addr:192.168.115.10  Bcast:0.0.0.0  Mask:255.255.255.0<br>          inet6 addr: fe80::84b6:6bff:fee8:2e4d/64 Scope:Link<br>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1<br>          RX packets:8 errors:0 dropped:0 overruns:0 frame:0<br>          TX packets:9 errors:0 dropped:0 overruns:0 carrier:0<br>          collisions:0 txqueuelen:1000 <br>          RX bytes:648 (648.0 B)  TX bytes:690 (690.0 B)<br><br>root@a46657528059:/<span class="hljs-comment"># route -n</span><br>Kernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>0.0.0.0         192.168.115.2   0.0.0.0         UG    0      0        0 eth0<br>192.168.115.0   0.0.0.0         255.255.255.0   U     0      0        0 eth0<br></code></pre></td></tr></table></figure>
<p>ä½¿ç”¨ip netnsæ·»åŠ é™æ€è·¯ç”±ï¼Œé¿å…åˆ›å»ºå®¹å™¨ä½¿ç”¨â€“privileged=trueé€‰é¡¹é€ æˆä¸€äº›ä¸å¿…è¦çš„å®‰å…¨é—®é¢˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker inspect --format=<span class="hljs-string">&quot;&#123;&#123; .State.Pid &#125;&#125;&quot;</span> a46657528059 <span class="hljs-comment"># è·å–æŒ‡å®šå®¹å™¨ pid</span><br>6350<br>$ sudo <span class="hljs-built_in">ln</span> -s /proc/6350/ns/net /var/run/netns/6350<br>$ sudo ip netns <span class="hljs-built_in">exec</span> 6350 ip route add 192.168.0.0/16 dev eth0 via 192.168.115.2<br>$ sudo ip netns <span class="hljs-built_in">exec</span> 6350 ip route    <span class="hljs-comment"># æ·»åŠ æˆåŠŸ</span><br>192.168.0.0/16 via 192.168.115.2 dev eth0 <br>... ...<br></code></pre></td></tr></table></figure>
<p>åœ¨å…¶å®ƒå®¿ä¸»æœºè¿›è¡Œç›¸åº”çš„é…ç½®ï¼Œæ–°å»ºå®¹å™¨å¹¶ä½¿ç”¨ pipework æ·»åŠ è™šæ‹Ÿç½‘å¡æ¡¥æ¥åˆ° br0ï¼Œæµ‹è¯•é€šä¿¡æƒ…å†µå³å¯ã€‚</p>
<p>å¦å¤–ï¼Œpipework å¯ä»¥åˆ›å»ºå®¹å™¨çš„ vlan ç½‘ç»œï¼Œè¿™é‡Œä¸ä½œè¿‡å¤šçš„ä»‹ç»äº†ï¼Œå®˜æ–¹æ–‡æ¡£å·²ç»å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œå¯ä»¥æŸ¥çœ‹ä»¥ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/jpetazzo/pipework">Pipework å®˜æ–¹æ–‡æ¡£</a></li>
<li><a target="_blank" rel="noopener" href="http://www.infoq.com/cn/articles/docker-network-and-pipework-open-source-explanation-practice">Docker ç½‘ç»œè¯¦è§£åŠ pipework æºç è§£è¯»ä¸å®è·µ</a></li>
</ul>
<h1 id="ä¸ƒã€Dockerfile"><a class="header-anchor" href="#ä¸ƒã€Dockerfile"></a>ä¸ƒã€Dockerfile</h1>
<p>Docker å¯ä»¥é€šè¿‡ Dockerfile çš„å†…å®¹æ¥è‡ªåŠ¨æ„å»ºé•œåƒã€‚Dockerfile æ˜¯ä¸€ä¸ªåŒ…å«åˆ›å»ºé•œåƒæ‰€æœ‰å‘½ä»¤çš„æ–‡æœ¬æ–‡ä»¶ï¼Œé€šè¿‡docker buildå‘½ä»¤å¯ä»¥æ ¹æ® Dockerfile çš„å†…å®¹æ„å»ºé•œåƒï¼Œåœ¨ä»‹ç»å¦‚ä½•æ„å»ºä¹‹å‰å…ˆä»‹ç»ä¸‹ Dockerfile çš„åŸºæœ¬è¯­æ³•ç»“æ„ã€‚</p>
<p>Dockerfile æœ‰ä»¥ä¸‹æŒ‡ä»¤é€‰é¡¹:</p>
<ul>
<li>FROM</li>
<li>MAINTAINER</li>
<li>RUN</li>
<li>CMD</li>
<li>EXPOSE</li>
<li>ENV</li>
<li>ADD</li>
<li>COPY</li>
<li>ENTRYPOINT</li>
<li>VOLUME</li>
<li>USER</li>
<li>WORKDIR</li>
<li>ONBUILD</li>
</ul>
<h2 id="7-1-FROM"><a class="header-anchor" href="#7-1-FROM"></a>7.1 FROM</h2>
<p>ç”¨æ³•:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">FROM &lt;image&gt;<br></code></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">FROM &lt;image&gt;<br></code></pre></td></tr></table></figure>
<ul>
<li>FROMæŒ‡å®šæ„å»ºé•œåƒçš„åŸºç¡€æºé•œåƒï¼Œå¦‚æœæœ¬åœ°æ²¡æœ‰æŒ‡å®šçš„é•œåƒï¼Œåˆ™ä¼šè‡ªåŠ¨ä» Docker çš„å…¬å…±åº“ pull é•œåƒä¸‹æ¥ã€‚</li>
<li>FROMå¿…é¡»æ˜¯ Dockerfile ä¸­éæ³¨é‡Šè¡Œçš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤ï¼Œå³ä¸€ä¸ª Dockerfile ä»FROMè¯­å¥å¼€å§‹ã€‚</li>
<li>FROMå¯ä»¥åœ¨ä¸€ä¸ª Dockerfile ä¸­å‡ºç°å¤šæ¬¡ï¼Œå¦‚æœæœ‰éœ€æ±‚åœ¨ä¸€ä¸ª Dockerfile ä¸­åˆ›å»ºå¤šä¸ªé•œåƒã€‚</li>
<li>å¦‚æœFROMè¯­å¥æ²¡æœ‰æŒ‡å®šé•œåƒæ ‡ç­¾ï¼Œåˆ™é»˜è®¤ä½¿ç”¨latestæ ‡ç­¾ã€‚</li>
</ul>
<h2 id="7-2-MAINTAINER"><a class="header-anchor" href="#7-2-MAINTAINER"></a>7.2 MAINTAINER</h2>
<p>ç”¨æ³•:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">MAINTAINER &lt;name&gt;<br></code></pre></td></tr></table></figure>
<p>æŒ‡å®šåˆ›å»ºé•œåƒçš„ç”¨æˆ·</p>
<p>RUN æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼</p>
<ul>
<li>RUN</li>
<li>RUNÂ <a target="_blank" rel="noopener" href="http://opskumu.github.io/exec%20form">â€œexecutableâ€, â€œparam1â€, â€œparam2â€</a></li>
</ul>
<p>æ¯æ¡RUNæŒ‡ä»¤å°†åœ¨å½“å‰é•œåƒåŸºç¡€ä¸Šæ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œå¹¶æäº¤ä¸ºæ–°çš„é•œåƒï¼Œåç»­çš„RUNéƒ½åœ¨ä¹‹å‰RUNæäº¤åçš„é•œåƒä¸ºåŸºç¡€ï¼Œé•œåƒæ˜¯åˆ†å±‚çš„ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªé•œåƒçš„ä»»ä½•ä¸€ä¸ªå†å²æäº¤ç‚¹æ¥åˆ›å»ºï¼Œç±»ä¼¼æºç çš„ç‰ˆæœ¬æ§åˆ¶ã€‚</p>
<p>exec æ–¹å¼ä¼šè¢«è§£æä¸ºä¸€ä¸ª JSON æ•°ç»„ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨åŒå¼•å·è€Œä¸æ˜¯å•å¼•å·ã€‚exec æ–¹å¼ä¸ä¼šè°ƒç”¨ä¸€ä¸ªå‘½ä»¤ shellï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šç»§æ‰¿ç›¸åº”çš„å˜é‡ï¼Œå¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">RUN [ <span class="hljs-string">&quot;echo&quot;</span>, <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>&quot;</span> ]<br></code></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼æ˜¯ä¸ä¼šè¾¾åˆ°è¾“å‡º HOME å˜é‡çš„ï¼Œæ­£ç¡®çš„æ–¹å¼åº”è¯¥æ˜¯è¿™æ ·çš„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">RUN [ <span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;echo&quot;</span>, <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>&quot;</span> ]<br></code></pre></td></tr></table></figure>
<p>RUNäº§ç”Ÿçš„ç¼“å­˜åœ¨ä¸‹ä¸€æ¬¡æ„å»ºçš„æ—¶å€™æ˜¯ä¸ä¼šå¤±æ•ˆçš„ï¼Œä¼šè¢«é‡ç”¨ï¼Œå¯ä»¥ä½¿ç”¨â€“no-cacheé€‰é¡¹ï¼Œå³docker build --no-cacheï¼Œå¦‚æ­¤ä¾¿ä¸ä¼šç¼“å­˜ã€‚</p>
<h2 id="7-3-CMD"><a class="header-anchor" href="#7-3-CMD"></a>7.3 CMD</h2>
<p>CMDæœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼:</p>
<ul>
<li>CMDÂ <a target="_blank" rel="noopener" href="http://opskumu.github.io/exec%20form,%20this%20is%20the%20preferred%20form,%20%E4%BC%98%E5%85%88%E9%80%89%E6%8B%A9">â€œexecutableâ€,â€œparam1â€,â€œparam2â€</a></li>
<li>CMDÂ <a target="_blank" rel="noopener" href="http://opskumu.github.io/as%20default%20parameters%20to%20%60ENTRYPOINT%60">â€œparam1â€,â€œparam2â€</a></li>
<li>CMD command param1 param2 (shell form)</li>
</ul>
<p>CMDæŒ‡å®šåœ¨ Dockerfile ä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆã€‚</p>
<p>CMDçš„ç›®çš„æ˜¯ä¸ºäº†åœ¨å¯åŠ¨å®¹å™¨æ—¶æä¾›ä¸€ä¸ªé»˜è®¤çš„å‘½ä»¤æ‰§è¡Œé€‰é¡¹ã€‚å¦‚æœç”¨æˆ·å¯åŠ¨å®¹å™¨æ—¶æŒ‡å®šäº†è¿è¡Œçš„å‘½ä»¤ï¼Œåˆ™ä¼šè¦†ç›–æ‰CMDæŒ‡å®šçš„å‘½ä»¤ã€‚</p>
<blockquote>
<p>CMDä¼šåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™æ‰§è¡Œï¼Œbuild æ—¶ä¸æ‰§è¡Œï¼Œè€ŒRUNåªæ˜¯åœ¨æ„å»ºé•œåƒçš„æ—¶å€™æ‰§è¡Œï¼Œåç»­é•œåƒæ„å»ºå®Œæˆä¹‹åï¼Œå¯åŠ¨å®¹å™¨å°±ä¸RUNæ— å…³äº†ï¼Œè¿™ä¸ªåˆå­¦è€…å®¹æ˜“å¼„æ··è¿™ä¸ªæ¦‚å¿µï¼Œè¿™é‡Œç®€å•æ³¨è§£ä¸€ä¸‹ã€‚</p>
</blockquote>
<h2 id="7-4-EXPOSE"><a class="header-anchor" href="#7-4-EXPOSE"></a>7.4 EXPOSE</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">EXPOSE &lt;port&gt; [&lt;port&gt;...]<br></code></pre></td></tr></table></figure>
<p>å‘Šè¯‰ Docker æœåŠ¡ç«¯å®¹å™¨å¯¹å¤–æ˜ å°„çš„æœ¬åœ°ç«¯å£ï¼Œéœ€è¦åœ¨ docker run çš„æ—¶å€™ä½¿ç”¨-pæˆ–è€…-Pé€‰é¡¹ç”Ÿæ•ˆã€‚</p>
<h2 id="7-5-ENV"><a class="header-anchor" href="#7-5-ENV"></a>7.5 ENV</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ENV &lt;key&gt; &lt;value&gt;       <span class="hljs-comment"># åªèƒ½è®¾ç½®ä¸€ä¸ªå˜é‡</span><br>ENV &lt;key&gt;=&lt;value&gt; ...   <span class="hljs-comment"># å…è®¸ä¸€æ¬¡è®¾ç½®å¤šä¸ªå˜é‡</span><br></code></pre></td></tr></table></figure>
<p>æŒ‡å®šä¸€ä¸ªç¯èŠ‚å˜é‡ï¼Œä¼šè¢«åç»­RUNæŒ‡ä»¤ä½¿ç”¨ï¼Œå¹¶åœ¨å®¹å™¨è¿è¡Œæ—¶ä¿ç•™ã€‚</p>
<p>ä¾‹å­:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ENV myName=<span class="hljs-string">&quot;John Doe&quot;</span> myDog=Rex\ The\ Dog \<br>    myCat=fluffy<br></code></pre></td></tr></table></figure>
<p>ç­‰åŒäº</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ENV myName John Doe<br>ENV myDog Rex The Dog<br>ENV myCat fluffy<br></code></pre></td></tr></table></figure>
<h2 id="7-6-ADD"><a class="header-anchor" href="#7-6-ADD"></a>7.6 ADD</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ADD &lt;src&gt;... &lt;dest&gt;<br></code></pre></td></tr></table></figure>
<p>ADDå¤åˆ¶æœ¬åœ°ä¸»æœºæ–‡ä»¶ã€ç›®å½•æˆ–è€…è¿œç¨‹æ–‡ä»¶ URLS ä» å¹¶ä¸”æ·»åŠ åˆ°å®¹å™¨æŒ‡å®šè·¯å¾„ä¸­ ã€‚</p>
<p>æ”¯æŒé€šè¿‡ GO çš„æ­£åˆ™æ¨¡ç³ŠåŒ¹é…ï¼Œå…·ä½“è§„åˆ™å¯å‚è§Â <a target="_blank" rel="noopener" href="http://golang.org/pkg/path/filepath/#Match">Go filepath.Match</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ADD hom* /mydir/        <span class="hljs-comment"># adds all files starting with &quot;hom&quot;</span><br>ADD hom?.txt /mydir/    <span class="hljs-comment"># ? is replaced with any single character</span><br></code></pre></td></tr></table></figure>
<ul>
<li>è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼Œå¦‚æœ ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºå¯¹åº”ç›®å½•</li>
<li>è·¯å¾„å¿…é¡»æ˜¯ Dockerfile æ‰€åœ¨è·¯å¾„çš„ç›¸å¯¹è·¯å¾„</li>
<li>å¦‚æœæ˜¯ä¸€ä¸ªç›®å½•ï¼Œåªä¼šå¤åˆ¶ç›®å½•ä¸‹çš„å†…å®¹ï¼Œè€Œç›®å½•æœ¬èº«åˆ™ä¸ä¼šè¢«å¤åˆ¶</li>
</ul>
<h2 id="7-7-COPY"><a class="header-anchor" href="#7-7-COPY"></a>7.7 COPY</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">COPY &lt;src&gt;... &lt;dest&gt;<br></code></pre></td></tr></table></figure>
<p>COPYå¤åˆ¶æ–°æ–‡ä»¶æˆ–è€…ç›®å½•ä» å¹¶ä¸”æ·»åŠ åˆ°å®¹å™¨æŒ‡å®šè·¯å¾„ä¸­ ã€‚ç”¨æ³•åŒADDï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯ä¸èƒ½æŒ‡å®šè¿œç¨‹æ–‡ä»¶ URLSã€‚</p>
<h2 id="7-8-ENTRYPOINT"><a class="header-anchor" href="#7-8-ENTRYPOINT"></a>7.8 ENTRYPOINT</h2>
<ul>
<li>ENTRYPOINTÂ <a target="_blank" rel="noopener" href="http://opskumu.github.io/the%20preferred%20exec%20form%EF%BC%8C%E4%BC%98%E5%85%88%E9%80%89%E6%8B%A9">â€œexecutableâ€, â€œparam1â€, â€œparam2â€</a></li>
<li>ENTRYPOINT command param1 param2 (shell form)</li>
</ul>
<p>é…ç½®å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”ä¸å¯è¢« docker run æä¾›çš„å‚æ•°è¦†ç›–ï¼Œè€ŒCMDæ˜¯å¯ä»¥è¢«è¦†ç›–çš„ã€‚å¦‚æœéœ€è¦è¦†ç›–ï¼Œåˆ™å¯ä»¥ä½¿ç”¨docker run --entrypointé€‰é¡¹ã€‚</p>
<p>æ¯ä¸ª Dockerfile ä¸­åªèƒ½æœ‰ä¸€ä¸ªENTRYPOINTï¼Œå½“æŒ‡å®šå¤šä¸ªæ—¶ï¼Œåªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚</p>
<h3 id="Exec-form-ENTRYPOINT-ä¾‹å­"><a class="header-anchor" href="#Exec-form-ENTRYPOINT-ä¾‹å­"></a>Exec form ENTRYPOINT ä¾‹å­</h3>
<p>é€šè¿‡ENTRYPOINTä½¿ç”¨ exec form æ–¹å¼è®¾ç½®ç¨³å®šçš„é»˜è®¤å‘½ä»¤å’Œé€‰é¡¹ï¼Œè€Œä½¿ç”¨CMDæ·»åŠ é»˜è®¤ä¹‹å¤–ç»å¸¸è¢«æ”¹åŠ¨çš„é€‰é¡¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">FROM ubuntu<br>ENTRYPOINT [<span class="hljs-string">&quot;top&quot;</span>, <span class="hljs-string">&quot;-b&quot;</span>]<br>CMD [<span class="hljs-string">&quot;-c&quot;</span>]<br></code></pre></td></tr></table></figure>
<p>é€šè¿‡ Dockerfile ä½¿ç”¨ENTRYPOINTå±•ç¤ºå‰å°è¿è¡Œ Apache æœåŠ¡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">FROM debian:stable<br>RUN apt-get update &amp;&amp; apt-get install -y --force-yes apache2<br>EXPOSE 80 443<br>VOLUME [<span class="hljs-string">&quot;/var/www&quot;</span>, <span class="hljs-string">&quot;/var/log/apache2&quot;</span>, <span class="hljs-string">&quot;/etc/apache2&quot;</span>]<br>ENTRYPOINT [<span class="hljs-string">&quot;/usr/sbin/apache2ctl&quot;</span>, <span class="hljs-string">&quot;-D&quot;</span>, <span class="hljs-string">&quot;FOREGROUND&quot;</span>]<br></code></pre></td></tr></table></figure>
<h3 id="Shell-form-ENTRYPOINT-ä¾‹å­"><a class="header-anchor" href="#Shell-form-ENTRYPOINT-ä¾‹å­"></a>Shell form ENTRYPOINT ä¾‹å­</h3>
<p>è¿™ç§æ–¹å¼ä¼šåœ¨/bin/sh -cä¸­æ‰§è¡Œï¼Œä¼šå¿½ç•¥ä»»ä½•CMDæˆ–è€…docker runå‘½ä»¤è¡Œé€‰é¡¹ï¼Œä¸ºäº†ç¡®ä¿docker stopèƒ½å¤Ÿåœæ­¢é•¿æ—¶é—´è¿è¡ŒENTRYPOINTçš„å®¹å™¨ï¼Œç¡®ä¿æ‰§è¡Œçš„æ—¶å€™ä½¿ç”¨execé€‰é¡¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">FROM ubuntu<br>ENTRYPOINT <span class="hljs-built_in">exec</span> top -b<br></code></pre></td></tr></table></figure>
<p>å¦‚æœåœ¨ENTRYPOINTå¿˜è®°ä½¿ç”¨execé€‰é¡¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨CMDè¡¥ä¸Š:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">FROM ubuntu<br>ENTRYPOINT top -b<br>CMD --ignored-param1 <span class="hljs-comment"># --ignored-param2 ... --ignored-param3 ... ä¾æ­¤ç±»æ¨</span><br></code></pre></td></tr></table></figure>
<h2 id="7-9-VOLUME"><a class="header-anchor" href="#7-9-VOLUME"></a>7.9 VOLUME</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">VOLUME [<span class="hljs-string">&quot;/data&quot;</span>]<br></code></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªå¯ä»¥ä»æœ¬åœ°ä¸»æœºæˆ–å…¶ä»–å®¹å™¨æŒ‚è½½çš„æŒ‚è½½ç‚¹ï¼Œåç»­å…·ä½“ä»‹ç»ã€‚</p>
<h2 id="7-10-USER"><a class="header-anchor" href="#7-10-USER"></a>7.10 USER</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">USER daemon<br></code></pre></td></tr></table></figure>
<p>æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„ç”¨æˆ·åæˆ– UIDï¼Œåç»­çš„RUNã€CMDã€ENTRYPOINTä¹Ÿä¼šä½¿ç”¨æŒ‡å®šç”¨æˆ·ã€‚</p>
<h2 id="7-11-WORKDIR"><a class="header-anchor" href="#7-11-WORKDIR"></a>7.11 WORKDIR</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">WORKDIR /path/to/workdir<br></code></pre></td></tr></table></figure>
<p>ä¸ºåç»­çš„RUNã€CMDã€ENTRYPOINTæŒ‡ä»¤é…ç½®å·¥ä½œç›®å½•ã€‚å¯ä»¥ä½¿ç”¨å¤šä¸ªWORKDIRæŒ‡ä»¤ï¼Œåç»­å‘½ä»¤å¦‚æœå‚æ•°æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ä¼šåŸºäºä¹‹å‰å‘½ä»¤æŒ‡å®šçš„è·¯å¾„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">WORKDIR /a<br>WORKDIR b<br>WORKDIR c<br>RUN <span class="hljs-built_in">pwd</span><br></code></pre></td></tr></table></figure>
<p>æœ€ç»ˆè·¯å¾„æ˜¯/a/b/cã€‚</p>
<p>WORKDIRæŒ‡ä»¤å¯ä»¥åœ¨ENVè®¾ç½®å˜é‡ä¹‹åè°ƒç”¨ç¯å¢ƒå˜é‡:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ENV DIRPATH /path<br>WORKDIR <span class="hljs-variable">$DIRPATH</span>/<span class="hljs-variable">$DIRNAME</span><br></code></pre></td></tr></table></figure>
<p>æœ€ç»ˆè·¯å¾„åˆ™ä¸º /path/$DIRNAMEã€‚</p>
<h2 id="7-12-ONBUILD"><a class="header-anchor" href="#7-12-ONBUILD"></a>7.12 ONBUILD</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ONBUILD [INSTRUCTION]<br></code></pre></td></tr></table></figure>
<p>é…ç½®å½“æ‰€åˆ›å»ºçš„é•œåƒä½œä¸ºå…¶å®ƒæ–°åˆ›å»ºé•œåƒçš„åŸºç¡€é•œåƒæ—¶ï¼Œæ‰€æ‰§è¡Œçš„æ“ä½œæŒ‡ä»¤ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒDockerfile ä½¿ç”¨å¦‚ä¸‹çš„å†…å®¹åˆ›å»ºäº†é•œåƒ image-Aï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[...]<br>ONBUILD ADD . /app/src<br>ONBUILD RUN /usr/local/bin/python-build --<span class="hljs-built_in">dir</span> /app/src<br>[...]<br></code></pre></td></tr></table></figure>
<p>å¦‚æœåŸºäº image-A åˆ›å»ºæ–°çš„é•œåƒæ—¶ï¼Œæ–°çš„ Dockerfile ä¸­ä½¿ç”¨ FROM image-A æŒ‡å®šåŸºç¡€é•œåƒæ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œ ONBUILD æŒ‡ä»¤å†…å®¹ï¼Œç­‰ä»·äºåœ¨åé¢æ·»åŠ äº†ä¸¤æ¡æŒ‡ä»¤ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Automatically run the following</span><br>ADD . /app/src<br>RUN /usr/local/bin/python-build --<span class="hljs-built_in">dir</span> /app/src<br></code></pre></td></tr></table></figure>
<p>ä½¿ç”¨ONBUILDæŒ‡ä»¤çš„é•œåƒï¼Œæ¨èåœ¨æ ‡ç­¾ä¸­æ³¨æ˜ï¼Œä¾‹å¦‚ ruby:1.9-onbuildã€‚</p>
<h2 id="7-13-Dockerfile-Examples"><a class="header-anchor" href="#7-13-Dockerfile-Examples"></a>7.13 Dockerfile Examples</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nginx</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># VERSION               0.0.1</span><br>FROM      ubuntu<br>MAINTAINER Victor Vieux &lt;victor@docker.com&gt;<br>RUN apt-get update &amp;&amp; apt-get install -y inotify-tools nginx apache2 openssh-server<br>  <br><span class="hljs-comment"># Firefox over VNC</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># VERSION               0.3</span><br>FROM ubuntu<br><span class="hljs-comment"># Install vnc, xvfb in order to create a &#x27;fake&#x27; display and firefox</span><br>RUN apt-get update &amp;&amp; apt-get install -y x11vnc xvfb firefox<br>RUN <span class="hljs-built_in">mkdir</span> ~/.vnc<br><span class="hljs-comment"># Setup a password</span><br>RUN x11vnc -storepasswd 1234 ~/.vnc/passwd<br><span class="hljs-comment"># Autostart firefox (might not be the best way, but it does the trick)</span><br>RUN bash -c <span class="hljs-string">&#x27;echo &quot;firefox&quot; &gt;&gt; /.bashrc&#x27;</span><br>EXPOSE 5900<br>CMD    [<span class="hljs-string">&quot;x11vnc&quot;</span>, <span class="hljs-string">&quot;-forever&quot;</span>, <span class="hljs-string">&quot;-usepw&quot;</span>, <span class="hljs-string">&quot;-create&quot;</span>]<br>  <br><span class="hljs-comment"># Multiple images example</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># VERSION               0.1</span><br>FROM ubuntu<br>RUN <span class="hljs-built_in">echo</span> foo &gt; bar<br><span class="hljs-comment"># Will output something like ===&gt; 907ad6c2736f</span><br>FROM ubuntu<br>RUN <span class="hljs-built_in">echo</span> moo &gt; oink<br><span class="hljs-comment"># Will output something like ===&gt; 695d7793cbe4</span><br> <br><span class="hljs-comment"># Youá¾¿ll now have two images, 907ad6c2736f with /bar, and 695d7793cbe4 with</span><br><span class="hljs-comment"># /oink.</span><br></code></pre></td></tr></table></figure>
<h2 id="7-14-docker-build"><a class="header-anchor" href="#7-14-docker-build"></a>7.14 docker build</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker build --<span class="hljs-built_in">help</span><br>Usage: docker build [OPTIONS] PATH | URL | -<br>Build a new image from the <span class="hljs-built_in">source</span> code at PATH<br>  --force-rm=<span class="hljs-literal">false</span>     Always remove intermediate containers, even after unsuccessful builds <span class="hljs-comment"># ç§»é™¤è¿‡æ¸¡å®¹å™¨ï¼Œå³ä½¿æ„å»ºå¤±è´¥</span><br>  --no-cache=<span class="hljs-literal">false</span>     Do not use cache when building the image                              <span class="hljs-comment"># ä¸å®ç”¨ cache        </span><br>  -q, --quiet=<span class="hljs-literal">false</span>    Suppress the verbose output generated by the containers               <br>  --<span class="hljs-built_in">rm</span>=<span class="hljs-literal">true</span>            Remove intermediate containers after a successful build               <span class="hljs-comment"># æ„å»ºæˆåŠŸåç§»é™¤è¿‡æ¸¡å±‚å®¹å™¨</span><br>  -t, --tag=<span class="hljs-string">&quot;&quot;</span>         Repository name (and optionally a tag) to be applied to the resulting image <span class="hljs-keyword">in</span> <span class="hljs-keyword">case</span> of success<br></code></pre></td></tr></table></figure>
<p>å‚è€ƒæ–‡æ¡£:<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/builder/">Dockerfile Reference</a></p>
<h2 id="7-15-dockerfile-æœ€ä½³å®è·µ"><a class="header-anchor" href="#7-15-dockerfile-æœ€ä½³å®è·µ"></a>7.15 dockerfile æœ€ä½³å®è·µ</h2>
<ul>
<li>ä½¿ç”¨.dockerignoreæ–‡ä»¶</li>
</ul>
<p>ä¸ºäº†åœ¨docker buildè¿‡ç¨‹ä¸­æ›´å¿«ä¸Šä¼ å’Œæ›´åŠ é«˜æ•ˆï¼Œåº”è¯¥ä½¿ç”¨ä¸€ä¸ª.dockerignoreæ–‡ä»¶ç”¨æ¥æ’é™¤æ„å»ºé•œåƒæ—¶ä¸éœ€è¦çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚ä¾‹å¦‚,é™¤é.gitåœ¨æ„å»ºè¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°ï¼Œå¦åˆ™ä½ åº”è¯¥å°†å®ƒæ·»åŠ åˆ°.dockerignoreæ–‡ä»¶ä¸­ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚</p>
<ul>
<li>é¿å…å®‰è£…ä¸å¿…è¦çš„è½¯ä»¶åŒ…</li>
</ul>
<p>ä¸ºäº†é™ä½å¤æ‚æ€§ã€ä¾èµ–æ€§ã€æ–‡ä»¶å¤§å°ä»¥åŠæ„å»ºæ—¶é—´ï¼Œåº”è¯¥é¿å…å®‰è£…é¢å¤–çš„æˆ–ä¸å¿…è¦çš„åŒ…ã€‚ä¾‹å¦‚ï¼Œä¸éœ€è¦åœ¨ä¸€ä¸ªæ•°æ®åº“é•œåƒä¸­å®‰è£…ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ã€‚</p>
<ul>
<li>æ¯ä¸ªå®¹å™¨éƒ½è·‘ä¸€ä¸ªè¿›ç¨‹</li>
</ul>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå®¹å™¨åº”è¯¥åªå•ç‹¬è·‘ä¸€ä¸ªç¨‹åºã€‚è§£è€¦åº”ç”¨åˆ°å¤šä¸ªå®¹å™¨ä½¿å…¶æ›´å®¹æ˜“æ¨ªå‘æ‰©å±•å’Œé‡ç”¨ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡ä¾èµ–å¦å¤–ä¸€ä¸ªæœåŠ¡ï¼Œå¯ä»¥å‚è€ƒÂ <a target="_blank" rel="noopener" href="https://docs.docker.com/userguide/dockerlinks/">Linking Containers Together</a>ã€‚</p>
<ul>
<li>æœ€å°åŒ–å±‚</li>
</ul>
<p>æˆ‘ä»¬çŸ¥é“æ¯æ‰§è¡Œä¸€ä¸ªæŒ‡ä»¤ï¼Œéƒ½ä¼šæœ‰ä¸€æ¬¡é•œåƒçš„æäº¤ï¼Œé•œåƒæ˜¯åˆ†å±‚çš„ç»“æ„ï¼Œå¯¹äºDockerfileï¼Œåº”è¯¥æ‰¾åˆ°å¯è¯»æ€§å’Œæœ€å°åŒ–å±‚ä¹‹é—´çš„å¹³è¡¡ã€‚</p>
<ul>
<li>å¤šè¡Œå‚æ•°æ’åº</li>
</ul>
<p>å¦‚æœå¯èƒ½ï¼Œé€šè¿‡å­—æ¯é¡ºåºæ¥æ’åºï¼Œè¿™æ ·å¯ä»¥é¿å…å®‰è£…åŒ…çš„é‡å¤å¹¶ä¸”æ›´å®¹æ˜“æ›´æ–°åˆ—è¡¨ï¼Œå¦å¤–å¯è¯»æ€§ä¹Ÿä¼šæ›´å¼ºï¼Œæ·»åŠ ä¸€ä¸ªç©ºè¡Œä½¿ç”¨\æ¢è¡Œ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">RUN apt-get update &amp;&amp; apt-get install -y \<br>  bzr \<br>  cvs \<br>  git \<br>  mercurial \<br>  subversion<br></code></pre></td></tr></table></figure>
<ul>
<li>åˆ›å»ºç¼“å­˜</li>
</ul>
<p>é•œåƒæ„å»ºè¿‡ç¨‹ä¸­ä¼šæŒ‰ç…§Dockerfileçš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œæ¯æ‰§è¡Œä¸€æ¬¡æŒ‡ä»¤ Docker ä¼šå¯»æ‰¾æ˜¯å¦æœ‰å­˜åœ¨çš„é•œåƒç¼“å­˜å¯å¤ç”¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºæ–°çš„é•œåƒã€‚å¦‚æœä¸æƒ³ä½¿ç”¨ç¼“å­˜ï¼Œåˆ™å¯ä»¥åœ¨docker buildæ—¶æ·»åŠ â€“no-cache=trueé€‰é¡¹ã€‚</p>
<p>ä»åŸºç¡€é•œåƒå¼€å§‹å°±å·²ç»åœ¨ç¼“å­˜ä¸­äº†ï¼Œä¸‹ä¸€ä¸ªæŒ‡ä»¤ä¼šå¯¹æ¯”æ‰€æœ‰çš„å­é•œåƒå¯»æ‰¾æ˜¯å¦æ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç¼“å­˜å¤±æ•ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹åªå¯¹æ¯”DockerfileæŒ‡ä»¤å’Œå­é•œåƒå°±è¶³å¤Ÿäº†ã€‚ADDå’ŒCOPYæŒ‡ä»¤é™¤å¤–ï¼Œæ‰§è¡ŒADDå’ŒCOPYæ—¶å­˜æ”¾åˆ°é•œåƒçš„æ–‡ä»¶ä¹Ÿæ˜¯éœ€è¦æ£€æŸ¥çš„ï¼Œå®Œæˆä¸€ä¸ªæ–‡ä»¶çš„æ ¡éªŒä¹‹åå†åˆ©ç”¨è¿™ä¸ªæ ¡éªŒåœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ£€æµ‹çš„æ–‡ä»¶æ”¹å˜åˆ™ç¼“å­˜å¤±æ•ˆã€‚RUN apt-get -y updateå‘½ä»¤åªæ£€æŸ¥å‘½ä»¤æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœåŒ¹é…å°±ä¸ä¼šå†æ‰§è¡Œæ›´æ–°äº†ã€‚</p>
<blockquote>
<p>ä¸ºäº†æœ‰æ•ˆåœ°åˆ©ç”¨ç¼“å­˜ï¼Œä½ éœ€è¦ä¿æŒä½ çš„ Dockerfile ä¸€è‡´ï¼Œå¹¶ä¸”å°½é‡åœ¨æœ«å°¾ä¿®æ”¹ã€‚</p>
</blockquote>
<h3 id="Dockerfile-æŒ‡ä»¤"><a class="header-anchor" href="#Dockerfile-æŒ‡ä»¤"></a>Dockerfile æŒ‡ä»¤</h3>
<ul>
<li>FROM: åªè¦å¯èƒ½å°±ä½¿ç”¨å®˜æ–¹é•œåƒåº“ä½œä¸ºåŸºç¡€é•œåƒ</li>
<li>RUN: ä¸ºä¿æŒå¯è¯»æ€§ã€æ–¹ä¾¿ç†è§£ã€å¯ç»´æŠ¤æ€§ï¼ŒæŠŠé•¿æˆ–è€…å¤æ‚çš„RUNè¯­å¥ä½¿ç”¨\åˆ†éš”ç¬¦åˆ†æˆå¤šè¡Œ
<ul>
<li>ä¸å»ºè®®RUN apt-get updateç‹¬ç«‹æˆè¡Œï¼Œå¦åˆ™å¦‚æœåç»­åŒ…æœ‰æ›´æ–°ï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šå†æ‰§è¡Œæ›´æ–°</li>
<li>é¿å…ä½¿ç”¨RUN apt-get upgradeæˆ–è€…dist-upgradeï¼Œå¾ˆå¤šå¿…è¦çš„åŒ…åœ¨ä¸€ä¸ªéprivilegedæƒé™çš„å®¹å™¨é‡Œæ˜¯æ— æ³•å‡çº§çš„ã€‚å¦‚æœçŸ¥é“æŸä¸ªåŒ…æ›´æ–°ï¼Œä½¿ç”¨apt-get install -y xxx</li>
<li>æ ‡å‡†å†™æ³•
<ul>
<li>RUN apt-get update &amp;&amp; apt-get install -y package-bar package-foo</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ä¾‹å­:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">RUN apt-get update &amp;&amp; apt-get install -y \<br>    aufs-tools \<br>    automake \<br>    btrfs-tools \<br>    build-essential \<br>    curl \<br>    dpkg-sig \<br>    git \<br>    iptables \<br>    libapparmor-dev \<br>    libcap-dev \<br>    libsqlite3-dev \<br>    lxc=1.0* \<br>    mercurial \<br>    parallel \<br>    reprepro \<br>    ruby1.9.1 \<br>    ruby1.9.1-dev \<br>    s3cmd=1.1.0*<br></code></pre></td></tr></table></figure>
<ul>
<li>CMD: æ¨èä½¿ç”¨CMD [â€œexecutableâ€, â€œparam1â€, â€œparam2â€â€¦]è¿™ç§æ ¼å¼ï¼ŒCMD [â€œparamâ€, â€œparamâ€]åˆ™é…åˆENTRYPOINTä½¿ç”¨</li>
<li>EXPOSE: Dockerfile æŒ‡å®šè¦å…¬å¼€çš„ç«¯å£ï¼Œä½¿ç”¨docker runæ—¶æŒ‡å®šæ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£å³å¯</li>
<li>ENV: ä¸ºäº†ä½¿æ–°çš„è½¯ä»¶æ›´å®¹æ˜“è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨ENVæ›´æ–°PATHå˜é‡ã€‚å¦‚ENV PATH /usr/local/nginx/bin:$PATHç¡®ä¿CMD [â€œnginxâ€]å³å¯è¿è¡Œ</li>
</ul>
<p>ENVä¹Ÿå¯ä»¥è¿™æ ·å®šä¹‰å˜é‡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ENV PG_MAJOR 9.3<br>ENV PG_VERSION 9.3.4<br>RUN curl -SL http://example.com/postgres-<span class="hljs-variable">$PG_VERSION</span>.tar.xz | tar -xJC /usr/src/postgress &amp;&amp; â€¦<br>ENV PATH /usr/local/postgres-<span class="hljs-variable">$PG_MAJOR</span>/bin:<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure>
<ul>
<li>ADDorCOPY:ADDæ¯”COPYå¤šä¸€äº›ç‰¹æ€§ã€Œtar æ–‡ä»¶è‡ªåŠ¨è§£åŒ…å’Œæ”¯æŒè¿œç¨‹ URLã€ï¼Œä¸æ¨èæ·»åŠ è¿œç¨‹ URL</li>
</ul>
<p>å¦‚ä¸æ¨èè¿™ç§æ–¹å¼:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ADD http://example.com/big.tar.xz /usr/src/things/<br>RUN tar -xJf /usr/src/things/big.tar.xz -C /usr/src/things<br>RUN make -C /usr/src/things all<br></code></pre></td></tr></table></figure>
<p>æ¨èä½¿ç”¨ curl æˆ–è€… wget æ›¿æ¢ï¼Œä½¿ç”¨å¦‚ä¸‹æ–¹å¼:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">RUN <span class="hljs-built_in">mkdir</span> -p /usr/src/things \<br>    &amp;&amp; curl -SL http://example.com/big.tar.gz \<br>    | tar -xJC /usr/src/things \<br>    &amp;&amp; make -C /usr/src/things all<br></code></pre></td></tr></table></figure>
<p>å¦‚æœä¸éœ€è¦æ·»åŠ  tar æ–‡ä»¶ï¼Œæ¨èä½¿ç”¨COPYã€‚</p>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/articles/dockerfile_best-practices/">Best practices for writing Dockerfiles</a></li>
<li><a target="_blank" rel="noopener" href="http://dockerone.com/article/131">Dockerfileæœ€ä½³å®è·µï¼ˆä¸€ï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="http://dockerone.com/article/132">Dockerfileæœ€ä½³å®è·µï¼ˆäºŒï¼‰</a></li>
</ul>
<h1 id="å…«ã€å®¹å™¨æ•°æ®ç®¡ç†"><a class="header-anchor" href="#å…«ã€å®¹å™¨æ•°æ®ç®¡ç†"></a>å…«ã€å®¹å™¨æ•°æ®ç®¡ç†</h1>
<p>dockerç®¡ç†æ•°æ®çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>æ•°æ®å·</li>
<li>æ•°æ®å·å®¹å™¨</li>
</ul>
<h2 id="8-1-æ•°æ®å·"><a class="header-anchor" href="#8-1-æ•°æ®å·"></a>8.1 æ•°æ®å·</h2>
<p>æ•°æ®å·æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä¸“é—¨æŒ‡å®šç»•è¿‡Union File Systemçš„ç›®å½•ï¼Œä¸ºæŒç»­æ€§æˆ–å…±äº«æ•°æ®æä¾›ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨é—´å…±äº«å’Œé‡ç”¨</li>
<li>æ•°æ®å·æ•°æ®æ”¹å˜æ˜¯ç›´æ¥ä¿®æ”¹çš„</li>
<li>æ•°æ®å·æ•°æ®æ”¹å˜ä¸ä¼šè¢«åŒ…æ‹¬åœ¨å®¹å™¨ä¸­</li>
<li>æ•°æ®å·æ˜¯æŒç»­æ€§çš„ï¼Œç›´åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨å®ƒä»¬</li>
</ul>
<h3 id="æ·»åŠ ä¸€ä¸ªæ•°æ®å·"><a class="header-anchor" href="#æ·»åŠ ä¸€ä¸ªæ•°æ®å·"></a>æ·»åŠ ä¸€ä¸ªæ•°æ®å·</h3>
<p>ä½ å¯ä»¥ä½¿ç”¨-vé€‰é¡¹æ·»åŠ ä¸€ä¸ªæ•°æ®å·ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨å¤šæ¬¡-vé€‰é¡¹ä¸ºä¸€ä¸ª docker å®¹å™¨è¿è¡ŒæŒ‚è½½å¤šä¸ªæ•°æ®å·ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run --name data -v /data -t -i ubuntu:14.04 /bin/bash <span class="hljs-comment"># åˆ›å»ºæ•°æ®å·ç»‘å®šåˆ°åˆ°æ–°å»ºå®¹å™¨ï¼Œæ–°å»ºå®¹å™¨ä¸­ä¼šåˆ›å»º /data æ•°æ®å· bash-4.1# ls -ld /data/</span><br>drwxr-xr-x 2 root root 4096 Jul 23 06:59 /data/<br>bash-4.1<span class="hljs-comment"># df -Th</span><br>Filesystem    Type    Size  Used Avail Use% Mounted on<br>... ...<br>              ext4     91G  4.6G   82G   6% /data<br></code></pre></td></tr></table></figure>
<p>åˆ›å»ºçš„æ•°æ®å·å¯ä»¥é€šè¿‡docker inspectè·å–å®¿ä¸»æœºå¯¹åº”è·¯å¾„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker inspect data<br>... ... <span class="hljs-string">&quot;Volumes&quot;</span>: &#123; <span class="hljs-string">&quot;/data&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/vfs/dir/151de401d268226f96d824fdf444e77a4500aed74c495de5980c807a2ffb7ea9&quot;</span> &#125;, <span class="hljs-comment"># å¯ä»¥çœ‹åˆ°åˆ›å»ºçš„æ•°æ®å·å®¿ä¸»æœºè·¯å¾„ ... ...</span><br></code></pre></td></tr></table></figure>
<p>æˆ–è€…ç›´æ¥æŒ‡å®šè·å–</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker inspect --format=<span class="hljs-string">&quot;&#123;&#123; .Volumes &#125;&#125;&quot;</span> data<br>map[/data: /var/lib/docker/vfs/dir/151de401d268226f96d824fdf444e77a4500aed74c495de5980c807a2ffb7ea9]<br></code></pre></td></tr></table></figure>
<h3 id="æŒ‚è½½å®¿ä¸»æœºç›®å½•ä¸ºä¸€ä¸ªæ•°æ®å·"><a class="header-anchor" href="#æŒ‚è½½å®¿ä¸»æœºç›®å½•ä¸ºä¸€ä¸ªæ•°æ®å·"></a>æŒ‚è½½å®¿ä¸»æœºç›®å½•ä¸ºä¸€ä¸ªæ•°æ®å·</h3>
<p>-vé€‰é¡¹é™¤äº†å¯ä»¥åˆ›å»ºå·ï¼Œä¹Ÿå¯ä»¥æŒ‚è½½å½“å‰ä¸»æœºçš„ä¸€ä¸ªç›®å½•åˆ°å®¹å™¨ä¸­ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run --name web -v /source/:/web -t -i ubuntu:14.04 /bin/bash<br>bash-4.1<span class="hljs-comment"># ls -ld /web/</span><br>drwxr-xr-x 2 root root 4096 Jul 23 06:59 /web/<br>bash-4.1<span class="hljs-comment"># df -Th</span><br>... ...<br>              ext4     91G  4.6G   82G   6% /web<br>bash-4.1<span class="hljs-comment"># exit </span><br></code></pre></td></tr></table></figure>
<p>é»˜è®¤æŒ‚è½½å·æ˜¯å¯è¯»å†™çš„ï¼Œå¯ä»¥åœ¨æŒ‚è½½æ—¶æŒ‡å®šåªè¯»</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run --<span class="hljs-built_in">rm</span> --name <span class="hljs-built_in">test</span> -v /source/:/test:ro -t -i ubuntu:14.04 /bin/bash<br></code></pre></td></tr></table></figure>
<h2 id="8-2-åˆ›å»ºå’ŒæŒ‚è½½ä¸€ä¸ªæ•°æ®å·å®¹å™¨"><a class="header-anchor" href="#8-2-åˆ›å»ºå’ŒæŒ‚è½½ä¸€ä¸ªæ•°æ®å·å®¹å™¨"></a>8.2 åˆ›å»ºå’ŒæŒ‚è½½ä¸€ä¸ªæ•°æ®å·å®¹å™¨</h2>
<p>å¦‚æœä½ æœ‰ä¸€äº›æŒä¹…æ€§çš„æ•°æ®å¹¶ä¸”æƒ³åœ¨å®¹å™¨é—´å…±äº«ï¼Œæˆ–è€…æƒ³ç”¨åœ¨éæŒä¹…æ€§çš„å®¹å™¨ä¸Šï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªæ•°æ®å·å®¹å™¨ï¼Œç„¶åä»æ­¤å®¹å™¨ä¸ŠæŒ‚è½½æ•°æ®ã€‚</p>
<p>åˆ›å»ºæ•°æ®å·å®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -t -i -d -v /test --name <span class="hljs-built_in">test</span> ubuntu:14.04 <span class="hljs-built_in">echo</span> hello<br></code></pre></td></tr></table></figure>
<p>ä½¿ç”¨â€“volumes-fromé€‰é¡¹åœ¨å¦ä¸€ä¸ªå®¹å™¨ä¸­æŒ‚è½½ /test å·ã€‚ä¸ç®¡ test å®¹å™¨æ˜¯å¦è¿è¡Œï¼Œå…¶å®ƒå®¹å™¨éƒ½å¯ä»¥æŒ‚è½½è¯¥å®¹å™¨æ•°æ®å·ï¼Œå½“ç„¶å¦‚æœåªæ˜¯å•ç‹¬çš„æ•°æ®å·æ˜¯æ²¡å¿…è¦è¿è¡Œå®¹å™¨çš„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -t -i -d --volumes-from <span class="hljs-built_in">test</span> --name test1 ubuntu:14.04 /bin/bash<br></code></pre></td></tr></table></figure>
<p>æ·»åŠ å¦ä¸€ä¸ªå®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -t -i -d --volumes-from <span class="hljs-built_in">test</span> --name test2 ubuntu:14.04 /bin/bash<br></code></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ç»§æ‰¿å…¶å®ƒæŒ‚è½½æœ‰ /test å·çš„å®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -t -i -d --volumes-from test1 --name test3 ubuntu:14.04 /bin/bash<br></code></pre></td></tr></table></figure>
<p><img src="http://static.open-open.com/lib/uploadImg/20150212/20150212091035_912.png" srcset="/img/loading.gif" lazyload alt="éå¸¸è¯¦ç»†çš„ Docker å­¦ä¹ ç¬”è®°"></p>
<h2 id="8-3-å¤‡ä»½ã€æ¢å¤æˆ–è¿ç§»æ•°æ®å·"><a class="header-anchor" href="#8-3-å¤‡ä»½ã€æ¢å¤æˆ–è¿ç§»æ•°æ®å·"></a>8.3 å¤‡ä»½ã€æ¢å¤æˆ–è¿ç§»æ•°æ®å·</h2>
<h3 id="å¤‡ä»½"><a class="header-anchor" href="#å¤‡ä»½"></a>å¤‡ä»½</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run --<span class="hljs-built_in">rm</span> --volumes-from <span class="hljs-built_in">test</span> -v $(<span class="hljs-built_in">pwd</span>):/backup ubuntu:14.04 tar cvf /backup/test.tar /test<br>tar: Removing leading `/<span class="hljs-string">&#x27; from member names</span><br><span class="hljs-string">/test/</span><br><span class="hljs-string">/test/b</span><br><span class="hljs-string">/test/d</span><br><span class="hljs-string">/test/c</span><br><span class="hljs-string">/test/a</span><br></code></pre></td></tr></table></figure>
<p>å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶ä¸”ä»testå®¹å™¨ä¸­æŒ‚è½½å·ï¼Œç„¶åæŒ‚è½½å½“å‰ç›®å½•åˆ°å®¹å™¨ä¸­ä¸º backupï¼Œå¹¶å¤‡ä»½ test å·ä¸­æ‰€æœ‰çš„æ•°æ®ä¸º test.tarï¼Œæ‰§è¡Œå®Œæˆä¹‹ååˆ é™¤å®¹å™¨â€“rmï¼Œæ­¤æ—¶å¤‡ä»½å°±åœ¨å½“å‰çš„ç›®å½•ä¸‹ï¼Œåä¸ºtest.tarã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> <span class="hljs-comment"># å®¿ä¸»æœºå½“å‰ç›®å½•ä¸‹äº§ç”Ÿäº† test å·çš„å¤‡ä»½æ–‡ä»¶ </span><br>test.tar test.tar<br></code></pre></td></tr></table></figure>
<h3 id="æ¢å¤"><a class="header-anchor" href="#æ¢å¤"></a>æ¢å¤</h3>
<p>ä½ å¯ä»¥æ¢å¤ç»™åŒä¸€ä¸ªå®¹å™¨æˆ–è€…å¦å¤–çš„å®¹å™¨ï¼Œæ–°å»ºå®¹å™¨å¹¶è§£å‹å¤‡ä»½æ–‡ä»¶åˆ°æ–°çš„å®¹å™¨æ•°æ®å·</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -t -i -d -v /test --name test4 ubuntu:14.04  /bin/bash <br>$ sudo docker run --<span class="hljs-built_in">rm</span> --volumes-from test4 -v $(<span class="hljs-built_in">pwd</span>):/backup ubuntu:14.04 tar xvf /backup/test.tar -C / <span class="hljs-comment"># æ¢å¤ä¹‹å‰çš„æ–‡ä»¶åˆ°æ–°å»ºå·ä¸­ï¼Œæ‰§è¡Œå®Œåè‡ªåŠ¨åˆ é™¤å®¹å™¨ </span><br><span class="hljs-built_in">test</span>/ <span class="hljs-built_in">test</span>/b <span class="hljs-built_in">test</span>/d <span class="hljs-built_in">test</span>/c <span class="hljs-built_in">test</span>/a<br></code></pre></td></tr></table></figure>
<h2 id="8-4-åˆ é™¤-Volumes"><a class="header-anchor" href="#8-4-åˆ é™¤-Volumes"></a>8.4 åˆ é™¤ Volumes</h2>
<p>Volume åªæœ‰åœ¨ä¸‹åˆ—æƒ…å†µä¸‹æ‰èƒ½è¢«åˆ é™¤ï¼š</p>
<ul>
<li>docker rm -våˆ é™¤å®¹å™¨æ—¶æ·»åŠ äº†-vé€‰é¡¹</li>
<li>docker run --rmè¿è¡Œå®¹å™¨æ—¶æ·»åŠ äº†â€“rmé€‰é¡¹</li>
</ul>
<p>å¦åˆ™ï¼Œä¼šåœ¨/var/lib/docker/vfs/dirç›®å½•ä¸­é—ç•™å¾ˆå¤šä¸æ˜ç›®å½•ã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://docs.docker.com/userguide/dockervolumes/#data-volumes">Managing Data in Containers</a></li>
<li><a target="_blank" rel="noopener" href="http://dockerone.com/article/128">æ·±å…¥ç†è§£Docker Volumeï¼ˆä¸€ï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="http://dockerone.com/article/129">æ·±å…¥ç†è§£Docker Volumeï¼ˆäºŒï¼‰</a></li>
</ul>
<h1 id="ä¹ã€é“¾æ¥å®¹å™¨"><a class="header-anchor" href="#ä¹ã€é“¾æ¥å®¹å™¨"></a>ä¹ã€é“¾æ¥å®¹å™¨</h1>
<p>docker å…è®¸æŠŠå¤šä¸ªå®¹å™¨è¿æ¥åœ¨ä¸€èµ·ï¼Œç›¸äº’äº¤äº’ä¿¡æ¯ã€‚docker é“¾æ¥ä¼šåˆ›å»ºä¸€ç§å®¹å™¨çˆ¶å­çº§åˆ«çš„å…³ç³»ï¼Œå…¶ä¸­çˆ¶å®¹å™¨å¯ä»¥çœ‹åˆ°å…¶å­å®¹å™¨æä¾›çš„ä¿¡æ¯ã€‚</p>
<h2 id="9-1-å®¹å™¨å‘½å"><a class="header-anchor" href="#9-1-å®¹å™¨å‘½å"></a>9.1 å®¹å™¨å‘½å</h2>
<p>åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œå¦‚æœä¸æŒ‡å®šå®¹å™¨çš„åå­—ï¼Œåˆ™é»˜è®¤ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåå­—ï¼Œè¿™é‡Œæ¨èç»™å®¹å™¨å‘½åï¼š</p>
<ul>
<li>1ã€ç»™å®¹å™¨å‘½åæ–¹ä¾¿è®°å¿†ï¼Œå¦‚å‘½åè¿è¡Œ web åº”ç”¨çš„å®¹å™¨ä¸º web</li>
<li>2ã€ä¸º docker å®¹å™¨æä¾›ä¸€ä¸ªå‚è€ƒï¼Œå…è®¸æ–¹ä¾¿å…¶ä»–å®¹å™¨è°ƒç”¨ï¼Œå¦‚æŠŠå®¹å™¨ web é“¾æ¥åˆ°å®¹å™¨ db</li>
</ul>
<p>å¯ä»¥é€šè¿‡â€“nameé€‰é¡¹ç»™å®¹å™¨è‡ªå®šä¹‰å‘½åï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -d -t -i --name <span class="hljs-built_in">test</span> ubuntu:14.04 bash              <br>$ sudo docker  inspect --format=<span class="hljs-string">&quot;&#123;&#123; .Nmae &#125;&#125;&quot;</span> <span class="hljs-built_in">test</span><br>/test<br></code></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šå®¹å™¨åç§°å¿…é¡»å”¯ä¸€ï¼Œå³ä½ åªèƒ½å‘½åä¸€ä¸ªå«testçš„å®¹å™¨ã€‚å¦‚æœä½ æƒ³å¤ç”¨å®¹å™¨åï¼Œåˆ™å¿…é¡»åœ¨åˆ›å»ºæ–°çš„å®¹å™¨å‰é€šè¿‡docker rmåˆ é™¤æ—§çš„å®¹å™¨æˆ–è€…åˆ›å»ºå®¹å™¨æ—¶æ·»åŠ â€“rmé€‰é¡¹ã€‚</p>
</blockquote>
<h2 id="9-2-é“¾æ¥å®¹å™¨"><a class="header-anchor" href="#9-2-é“¾æ¥å®¹å™¨"></a>9.2 é“¾æ¥å®¹å™¨</h2>
<p>é“¾æ¥å…è®¸å®¹å™¨é—´å®‰å…¨é€šä¿¡ï¼Œä½¿ç”¨â€“linké€‰é¡¹åˆ›å»ºé“¾æ¥ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -d --name db training/postgres<br></code></pre></td></tr></table></figure>
<p>åŸºäº training/postgres é•œåƒåˆ›å»ºä¸€ä¸ªåä¸º db çš„å®¹å™¨ï¼Œç„¶åä¸‹é¢åˆ›å»ºä¸€ä¸ªå«åš web çš„å®¹å™¨ï¼Œå¹¶ä¸”å°†å®ƒä¸ db ç›¸äº’è¿æ¥åœ¨ä¸€èµ·</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -d -P --name web --<span class="hljs-built_in">link</span> db:db training/webapp python app.py<br></code></pre></td></tr></table></figure>
<p>â€“link <name or id>:aliasé€‰é¡¹æŒ‡å®šé“¾æ¥åˆ°çš„å®¹å™¨ã€‚</p>
<p>æŸ¥çœ‹ web å®¹å™¨çš„é“¾æ¥å…³ç³»:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker inspect -f <span class="hljs-string">&quot;&#123;&#123; .HostConfig.Links &#125;&#125;&quot;</span> web<br>[/db:/web/db]<br></code></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° web å®¹å™¨è¢«é“¾æ¥åˆ° db å®¹å™¨ä¸º/web/dbï¼Œè¿™å…è®¸ web å®¹å™¨è®¿é—® db å®¹å™¨çš„ä¿¡æ¯ã€‚</p>
<p>å®¹å™¨ä¹‹é—´çš„é“¾æ¥å®é™…åšäº†ä»€ä¹ˆï¼Ÿä¸€ä¸ªé“¾æ¥å…è®¸ä¸€ä¸ªæºå®¹å™¨æä¾›ä¿¡æ¯è®¿é—®ç»™ä¸€ä¸ªæ¥æ”¶å®¹å™¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œweb å®¹å™¨ä½œä¸ºä¸€ä¸ªæ¥æ”¶è€…ï¼Œå…è®¸è®¿é—®æºå®¹å™¨ db çš„ç›¸å…³æœåŠ¡ä¿¡æ¯ã€‚Docker åˆ›å»ºäº†ä¸€ä¸ªå®‰å…¨éš§é“è€Œä¸éœ€è¦å¯¹å¤–å…¬å¼€ä»»ä½•ç«¯å£ç»™å¤–éƒ¨å®¹å™¨ï¼Œå› æ­¤ä¸éœ€è¦åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™æ·»åŠ -pæˆ–-PæŒ‡å®šå¯¹å¤–å…¬å¼€çš„ç«¯å£ï¼Œè¿™ä¹Ÿæ˜¯é“¾æ¥å®¹å™¨çš„æœ€å¤§å¥½å¤„ï¼Œæœ¬ä¾‹ä¸º PostgreSQL æ•°æ®åº“ã€‚</p>
<p>Docker ä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ–¹å¼æä¾›è¿æ¥ä¿¡æ¯ç»™æ¥æ”¶å®¹å™¨ï¼š</p>
<ul>
<li>ç¯å¢ƒå˜é‡</li>
<li>æ›´æ–°/etc/hostsæ–‡ä»¶</li>
</ul>
<h3 id="ç¯å¢ƒå˜é‡"><a class="header-anchor" href="#ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h3>
<p>å½“ä¸¤ä¸ªå®¹å™¨é“¾æ¥ï¼ŒDocker ä¼šåœ¨ç›®æ ‡å®¹å™¨ä¸Šè®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œä»¥è·å–æºå®¹å™¨çš„ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>é¦–å…ˆï¼ŒDocker ä¼šåœ¨æ¯ä¸ªé€šè¿‡â€“linké€‰é¡¹æŒ‡å®šåˆ«åçš„ç›®æ ‡å®¹å™¨ä¸Šè®¾ç½®ä¸€ä¸ª<alias>_NAMEç¯å¢ƒå˜é‡ã€‚å¦‚æœä¸€ä¸ªåä¸º web çš„å®¹å™¨é€šè¿‡â€“link db:webdbè¢«é“¾æ¥åˆ°ä¸€ä¸ªåä¸º db çš„æ•°æ®åº“å®¹å™¨ï¼Œé‚£ä¹ˆ web å®¹å™¨ä¸Šä¼šè®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡ä¸ºWEBDB_NAME=/web/webdb.</p>
<p>ä»¥ä¹‹å‰çš„ä¸ºä¾‹ï¼ŒDocker è¿˜ä¼šè®¾ç½®ç«¯å£å˜é‡:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run --<span class="hljs-built_in">rm</span> --name web2 --<span class="hljs-built_in">link</span> db:db training/webapp <span class="hljs-built_in">env</span><br>. . .<br>DB_NAME=/web2/db<br>DB_PORT=tcp://172.17.0.5:5432           <br>DB_PORT_5432_TCP=tcp://172.17.0.5:5432  <span class="hljs-comment"># &lt;name&gt;_PORT_&lt;port&gt;_&lt;protocol&gt; åè®®å¯ä»¥æ˜¯ TCP æˆ– UDP</span><br>DB_PORT_5432_TCP_PROTO=tcp<br>DB_PORT_5432_TCP_PORT=5432<br>DB_PORT_5432_TCP_ADDR=172.17.0.5<br>. . .<br></code></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šè¿™äº›ç¯å¢ƒå˜é‡åªè®¾ç½®ç»™å®¹å™¨ä¸­çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œç±»ä¼¼ä¸€äº›å®ˆæŠ¤è¿›ç¨‹ (å¦‚ sshd ) å½“ä»–ä»¬æ´¾ç”Ÿ shells æ—¶ä¼šæ¸…é™¤è¿™äº›å˜é‡</p>
</blockquote>
<h3 id="æ›´æ–°-etc-hostsæ–‡ä»¶"><a class="header-anchor" href="#æ›´æ–°-etc-hostsæ–‡ä»¶"></a>æ›´æ–°/etc/hostsæ–‡ä»¶</h3>
<p>é™¤äº†ç¯å¢ƒå˜é‡ï¼ŒDocker ä¼šåœ¨ç›®æ ‡å®¹å™¨ä¸Šæ·»åŠ ç›¸å…³ä¸»æœºæ¡ç›®åˆ°/etc/hostsä¸­ï¼Œä¸Šä¾‹ä¸­å°±æ˜¯ web å®¹å™¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo docker run -t -i --<span class="hljs-built_in">rm</span> --<span class="hljs-built_in">link</span> db:db training/webapp /bin/bash<br>root@aed84ee21bde:/opt/webapp<br><span class="hljs-comment"># cat /etc/hosts</span><br>172.17.0.7  aed84ee21bde<br>. . .<br>172.17.0.5  db<br></code></pre></td></tr></table></figure>
<blockquote>
<p>/etc/hostæ–‡ä»¶åœ¨æºå®¹å™¨è¢«é‡å¯ä¹‹åä¼šè‡ªåŠ¨æ›´æ–° IP åœ°å€ï¼Œè€Œç¯å¢ƒå˜é‡ä¸­çš„ IP åœ°å€åˆ™ä¸ä¼šè‡ªåŠ¨æ›´æ–°çš„ã€‚</p>
</blockquote>
<h1 id="åã€æ„å»ºç§æœ‰åº“"><a class="header-anchor" href="#åã€æ„å»ºç§æœ‰åº“"></a>åã€æ„å»ºç§æœ‰åº“</h1>
<p>Docker å®˜æ–¹æä¾›äº† docker registry çš„æ„å»ºæ–¹æ³•Â <a target="_blank" rel="noopener" href="https://github.com/docker/docker-registry">docker-registry</a></p>
<h2 id="10-1-å¿«é€Ÿæ„å»º"><a class="header-anchor" href="#10-1-å¿«é€Ÿæ„å»º"></a>10.1 å¿«é€Ÿæ„å»º</h2>
<p>å¿«é€Ÿæ„å»º docker registry é€šè¿‡ä»¥ä¸‹ä¸¤æ­¥:</p>
<ul>
<li>å®‰è£… docker</li>
<li>è¿è¡Œ registry:docker run -p 5000:5000 registry</li>
</ul>
<p>è¿™ç§æ–¹æ³•é€šè¿‡ Docker hub ä½¿ç”¨å®˜æ–¹é•œåƒÂ <a target="_blank" rel="noopener" href="https://registry.hub.docker.com/_/registry/">official image from the Docker hub</a></p>
<h2 id="10-2-ä¸ä½¿ç”¨å®¹å™¨æ„å»º-registry"><a class="header-anchor" href="#10-2-ä¸ä½¿ç”¨å®¹å™¨æ„å»º-registry"></a>10.2 ä¸ä½¿ç”¨å®¹å™¨æ„å»º registry</h2>
<h3 id="å®‰è£…å¿…è¦çš„è½¯ä»¶"><a class="header-anchor" href="#å®‰è£…å¿…è¦çš„è½¯ä»¶"></a>å®‰è£…å¿…è¦çš„è½¯ä»¶</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt-get install build-essential python-dev libevent-dev python-pip liblzma-dev<br></code></pre></td></tr></table></figure>
<h3 id="é…ç½®-docker-registry"><a class="header-anchor" href="#é…ç½®-docker-registry"></a>é…ç½® docker-registry</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo pip install docker-registry<br></code></pre></td></tr></table></figure>
<p>æˆ–è€… ä½¿ç”¨ github clone æ‰‹åŠ¨å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git <span class="hljs-built_in">clone</span> https://github.com/dotcloud/docker-registry.git<br>$ <span class="hljs-built_in">cd</span> docker-registry/<br>$ <span class="hljs-built_in">cp</span> config/config_sample.yml config/config.yml<br>$ <span class="hljs-built_in">mkdir</span> /data/registry -p<br>$ pip install .<br></code></pre></td></tr></table></figure>
<h3 id="è¿è¡Œ"><a class="header-anchor" href="#è¿è¡Œ"></a>è¿è¡Œ</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-registry<br></code></pre></td></tr></table></figure>
<h3 id="é«˜çº§å¯åŠ¨æ–¹å¼-ä¸æ¨è"><a class="header-anchor" href="#é«˜çº§å¯åŠ¨æ–¹å¼-ä¸æ¨è"></a>é«˜çº§å¯åŠ¨æ–¹å¼ [ä¸æ¨è]</h3>
<p>ä½¿ç”¨gunicornæ§åˆ¶:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gunicorn -c contrib/gunicorn_config.py docker_registry.wsgi:application<br></code></pre></td></tr></table></figure>
<p>æˆ–è€…å¯¹å¤–ç›‘å¬å¼€æ”¾</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gunicorn --access-logfile - --error-logfile - -k gevent -b 0.0.0.0:5000 -w 4 --max-requests 100 docker_registry.wsgi:application<br></code></pre></td></tr></table></figure>
<h2 id="10-3-æäº¤æŒ‡å®šå®¹å™¨åˆ°ç§æœ‰åº“"><a class="header-anchor" href="#10-3-æäº¤æŒ‡å®šå®¹å™¨åˆ°ç§æœ‰åº“"></a>10.3 æäº¤æŒ‡å®šå®¹å™¨åˆ°ç§æœ‰åº“</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker tag ubuntu:12.04 ç§æœ‰åº“IP:5000/ubuntu:12.04<br>$ docker push ç§æœ‰åº“IP:5000/ubuntu<br></code></pre></td></tr></table></figure>
<p>æ›´å¤šçš„é…ç½®é€‰é¡¹æ¨èé˜…è¯»å®˜æ–¹æ–‡æ¡£:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/docker/docker-registry/blob/master/README.md">Docker-Registry README</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/docker/docker-registry/blob/master/ADVANCED.md">Docker-Registry advanced use</a></li>
</ul>
<p>æ¥è‡ªï¼š<a target="_blank" rel="noopener" href="http://opskumu.github.io/docker.html">http://opskumu.github.io/docker.html</a></p>

                
              </div>
            
            <hr/>
            <div>

              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>éå¸¸è¯¦ç»†çš„Dockerå­¦ä¹ ç¬”è®°</div>
      <div>http://www.tung7.com/ä»–å±±ä¹‹çŸ³/detail_docker_study_note.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Tung</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>August 6, 2016</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - Non-commercial">
                    <i class="iconfont icon-nc"></i>
                  </span>
                </a>
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="SA - Share-alike">
                    <i class="iconfont icon-sa"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2 side-col-post-right">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
<!--    <i class="iconfont icon-list"></i>-->
    ğŸ“’<span>TOC</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.events.registerRefreshCallback(function() {
      if ('mermaid' in window) {
        mermaid.init();
      }
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://github.com/hexojs/hexo" target="_blank">Hexo</a>ğŸ”¸<a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank">Fluid</a> <br> Â©ï¸ 2015-2023â¤ï¸Tung7 ç‰ˆæƒæ‰€æœ‰ | <a href="http://beian.miit.gov.cn" target="_blank" style="border-bottom:1px solid">ç²¤ICPå¤‡15069283å·</a> 
    </div>
  
  
  
    <!-- å¤‡æ¡ˆä¿¡æ¯ ICP for China -->
    <div class="beian">
  <span>
      
  </span>
  
</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>





  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
